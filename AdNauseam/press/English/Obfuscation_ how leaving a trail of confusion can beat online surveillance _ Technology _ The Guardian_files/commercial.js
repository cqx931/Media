define("common/modules/commercial/article-aside-adverts",["fastdom","Promise","common/utils/_","common/utils/$","common/utils/$css","common/utils/config","common/modules/commercial/create-ad-slot","common/modules/commercial/commercial-features"],function(e,o,n,t,i,c,r,m){function a(a){var s,l,u,d,f=n.defaults(a||{},{columnSelector:".js-secondary-column",adSlotContainerSelector:".js-ad-slot-container"}),g=t(f.columnSelector),p=g.length&&"none"===i(g,"display");return!m.articleAsideAdverts||p?!1:(s="Article"===c.page.contentType?t(".js-content-main-column"):!1,u=t(".js-components-container",".js-secondary-column"),d=t(f.adSlotContainerSelector),new o(function(o){e.read(function(){l=!s.length||"football"!==c.page.section&&s.dim().height>=1300||"football"===c.page.section&&s.dim().height>=2200?"right-sticky":s.dim().height>=600?"right":"right-small",e.write(function(){"Article"===c.page.contentType&&"advertisement-features"===c.page.sponsorshipType&&u.addClass("u-h"),d.append(r(l,"mpu-banner-ad")),o(d)})})}))}return{init:a}}),define("common/modules/commercial/article-body-adverts",["fastdom","Promise","common/utils/_","common/utils/$","common/utils/config","common/utils/detect","common/modules/article/spacefinder","common/modules/commercial/create-ad-slot","common/modules/commercial/commercial-features"],function(e,o,n,t,i,c,r,m,a){function s(){return{minAbove:c.isBreakpoint({max:"tablet"})?300:700,minBelow:300,selectors:{" > h2":{minAbove:"mobile"===c.getBreakpoint()?20:0,minBelow:250}," > *:not(p):not(h2)":{minAbove:35,minBelow:400}," .ad-slot":{minAbove:500,minBelow:500}}}}function l(){var e=n.cloneDeep(s());return e.minAbove=300,e.selectors[" > h2"].minAbove=20,e}function u(){var e=n.cloneDeep(s());return e.selectors[" .ad-slot"]={minAbove:1300,minBelow:1300},e}function d(){return r.getParaWithSpace(u()).then(function(e){return"undefined"==typeof e||f.length>=9?o.resolve(null):(g.push(["inline"+(f.length+1),"inline"]),p(e).then(function(){return d()}))})}var f=[],g=[["inline1","inline"],["inline2","inline"]],p=function(n){if(n){var i=g[f.length],c=t.create(m(i[0],i[1]));return f.push(c),new o(function(o){e.write(function(){c.insertBefore(n),o(null)})})}return o.resolve(null)},h=function(){var e,n,t;return a.articleBodyAdverts?(e=s(),n=l(),i.page.hasInlineMerchandise?(g.unshift(["im","im"]),t=r.getParaWithSpace(n).then(function(e){return p(e)})):t=o.resolve(null),i.switches.viewability&&"mobile"!==c.getBreakpoint()?t.then(function(){return r.getParaWithSpace(e).then(function(e){return p(e)}).then(function(){return r.getParaWithSpace(e).then(function(e){return p(e)}).then(function(){return d()})})}):t.then(function(){return r.getParaWithSpace(e).then(function(e){return p(e)}).then(function(){return c.isBreakpoint({max:"tablet"})?r.getParaWithSpace(e).then(function(e){return p(e)}):o.resolve(null)})})):!1};return{init:h,getRules:s,getLenientRules:l,reset:function(){f=[]}}}),define("common/modules/commercial/front-commercial-components",["bonzo","common/utils/$","common/utils/config","common/modules/commercial/create-ad-slot","common/modules/commercial/commercial-features"],function(e,o,n,t,i){function c(){if(!i.frontCommercialComponents)return!1;var c,r=o.create('<div class="fc-container"></div>'),m=e(t("merchandising-high","commercial-component-high")),a=o(".fc-container");return a.length>=2?(c=0,a.length>=4&&(c="Network Front"===n.page.contentType?3:2),r.append(m).insertAfter(a[c])):void 0}return{init:c}}),define("common/modules/commercial/slice-adverts",["bonzo","fastdom","qwery","Promise","common/utils/$","common/utils/_","common/utils/config","common/utils/detect","common/modules/commercial/create-ad-slot","common/modules/user-prefs","common/modules/commercial/commercial-features"],function(e,o,n,t,i,c,r,m,a,s,l){var u=["inline1","inline2","inline3"],d=function(d){if(!l.sliceAdverts)return!1;for(var f,g,p,h,w=c.defaults(d||{},{containerSelector:".fc-container",sliceSelector:".js-fc-slice-mpu-candidate"}),v=n(w.containerSelector),b=0,y=[],k=1,A=s.get("container-states");b<v.length;)f=v[b],g=e(f).data("id"),p=i(w.sliceSelector,f),h=c.contains(["uk","us","au"],r.page.pageId)&&0===b,!p.length||h||A&&"closed"===A[g]||r.page.omitMPUs?(i(f).addClass("omitted-mpus"),b++):(y.push(p.first()),b+=k+1);return t.all(c(y).slice(0,u.length).map(function(n,c){var r=u[c],s=e(a(r,"container-inline")).addClass("ad-slot--mobile"),l=e(a(r,"container-inline")).addClass("ad-slot--not-mobile");return new t(function(e){o.write(function(){"mobile"!==m.getBreakpoint()?n.removeClass("fc-slice__item--no-mpu").append(l):s.insertAfter(i.ancestor(n[0],"fc-container")),e(null)})})}).valueOf()).then(function(){return y})};return{init:d}}),define("common/modules/commercial/third-party-tags/audience-science-gateway",["common/utils/config"],function(e){function o(){return e.switches.audienceScienceGateway?require(["js!//js.revsci.net/gateway/gw.js?csid=F09828&auto=t&bpid=theguardian"]):void 0}return{load:o}}),define("common/modules/commercial/third-party-tags/imr-worldwide",["common/utils/config"],function(e){function o(){if(e.switches.imrWorldwide){var o=new Image;return o.src=["//secure-uk.imrworldwide.com/cgi-bin/m?ci=uk-305078h&cg=0&cc=1&ts=compact","&si=",encodeURI(window.location.href),"&rp=",encodeURI(document.referrer),"&rnd=",(new Date).getTime()].join(""),o}}return{load:o}}),define("common/modules/commercial/third-party-tags/remarketing",["common/utils/config"],function(e){function o(){return e.switches.remarketing?require(["js!"+n],function(){window.google_trackConversion({google_conversion_id:971225648,google_custom_params:window.google_tag_params,google_remarketing_only:!0})}):void 0}var n="//www.googleadservices.com/pagead/conversion_async.js";return{load:o}}),define("text!common/views/commercial/outbrain.html",[],function(){return'<div class="OUTBRAIN" data-widget-id="<%=widgetCode%>" data-ob-template="guardian"></div>'}),define("common/modules/commercial/third-party-tags/outbrain",["fastdom","common/utils/$","common/utils/_","common/utils/config","common/utils/detect","common/utils/mediator","common/utils/template","common/modules/identity/api","text!common/views/commercial/outbrain.html"],function(e,o,n,t,i,c,r,m,a){var s="//widgets.outbrain.com/outbrain.js";return{load:function(){var t,c,m,l=o(".js-outbrain"),u=o(".js-outbrain-container"),d={},f=i.getBreakpoint(),g=this.getSection();f=n.contains(["wide","desktop"],f)?"desktop":f,d={desktop:{image:{sections:"AR_12",all:"AR_13"},text:{sections:"AR_14",all:"AR_15"}},tablet:{image:{sections:"MB_6",all:"MB_7"},text:{sections:"MB_8",all:"MB_9"}},mobile:{image:{sections:"MB_4",all:"MB_5"}}},c=d[f].image[g],t=c,e.write(function(){l.css("display","block"),u.append(o.create(r(a,{widgetCode:t}))),"mobile"!==f&&(m=d[f].text[g],u.append(o.create(r(a,{widgetCode:m})))),this.tracking(t),require(["js!"+s])}.bind(this))},tracking:function(e){var o=window.s;o.link2="outbrain",o.tl(!0,"o","outbrain"),require(["ophan/ng"],function(o){o.record({outbrain:{widgetId:e}})})},getSection:function(){return t.page.section.toLowerCase().match("news")||n.contains(["politics","world","business","commentisfree"],t.page.section.toLowerCase())?"sections":"all"},identityPolicy:function(){return!m.isUserLoggedIn()||!(m.isUserLoggedIn()&&t.page.commentable)},hasHighRelevanceComponent:function(){return i.adblockInUse()||"int"===t.page.edition.toLowerCase()},init:function(){t.switches.outbrain&&!t.page.isFront&&!t.page.isPreview&&this.identityPolicy()&&"childrens-books-site"!==t.page.section&&(this.hasHighRelevanceComponent()?this.load():c.on("modules:commercial:dfp:rendered",function(e){"dfp-ad--merchandising-high"===e.slot.getSlotId().getDomId()&&e.isEmpty&&this.load()}.bind(this)))}}}),define("common/modules/commercial/third-party-tags",["Promise","common/utils/config","common/utils/mediator","common/modules/commercial/commercial-features","common/modules/commercial/third-party-tags/audience-science-gateway","common/modules/commercial/third-party-tags/audience-science-pql","common/modules/commercial/third-party-tags/imr-worldwide","common/modules/commercial/third-party-tags/remarketing","common/modules/commercial/third-party-tags/krux","common/modules/commercial/third-party-tags/outbrain"],function(e,o,n,t,i,c,r,m,a,s){function l(){if(!t.thirdPartyTags)return!1;switch(o.page.edition.toLowerCase()){case"uk":c.load(),i.load()}return s.init(),n.once("modules:commercial:dfp:rendered",function(){u()}),e.resolve(null)}function u(){r.load(),m.load(),a.load()}return{init:l}}),define("bootstraps/commercial",["Promise","common/utils/config","common/utils/mediator","common/utils/robust","common/utils/_","common/modules/commercial/article-aside-adverts","common/modules/commercial/article-body-adverts","common/modules/commercial/badges","common/modules/commercial/dfp","common/modules/commercial/front-commercial-components","common/modules/commercial/slice-adverts","common/modules/commercial/third-party-tags"],function(e,o,n,t,i,c,r,m,a,s,l,u){var d=[["cm-articleAsideAdverts",c.init],["cm-articleBodyAdverts",r.init],["cm-sliceAdverts",l.init],["cm-frontCommercialComponents",s.init],["cm-thirdPartyTags",u.init],["cm-badges",m.init]];return{init:function(){var c=[];i.forEach(d,function(e){t.catchErrorsAndLog(e[0],function(){c.push(e[1]())})}),e.all(c).then(function(){o.switches.commercial&&t.catchErrorsAndLogAll([["cm-dfp",a.init],["cm-ready",function(){n.emit("page:commercial:ready")}]])})}}});
//# sourceMappingURL=commercial.js.map