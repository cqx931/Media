
var FontStack=function(){var DEBUG=false;var self=this;this.content=$(".entry-content");this.modal=$("#text-modal");this.modalbody=$('.modal-body',this.modal);this.entrycontent=$('.hentry .entry-content');this.copynodes=$('.gridcol > p, .gridcol > ul, .gridcol > ol',this.entrycontent);this.enlargers=$('a[rel*="font"].btn',this.modal);this.previews=$('a',this.modalbody);this.trigger=$("a.typetrigger");this.init=function(){this.trigger.each(function(){$(this).on('click',function(e){e.preventDefault();self.modal.modal('toggle');});});this.selectEnlarger();this.selectFont();this.enlargers.on('click',function(e){e.preventDefault();self.saveSize(e);self.selectEnlarger();});this.previews.on('click',function(e){e.preventDefault();self.saveFont(e);self.selectFont(e);});}
this.selectEnlarger=function(){this.enlargers.each(function(){var elm=$(this);var rel=elm.attr('rel');if(rel==self.getsize()&&!elm.hasClass('selected')){elm.addClass('selected');self.modalbody.addClass(rel);self.content.addClass(rel);}else{elm.removeClass('selected');self.modalbody.removeClass(rel);self.content.removeClass(rel);}});}
this.selectFont=function(e){var target=null;if(e)target=$(e.target);if(DEBUG)console.log("target is ",target);this.previews.each(function(){var elm=$(this);var c=elm.attr('class');if(c==self.getFont()&&!elm.hasClass('selected')){elm.addClass('selected');self.content.addClass(c);}else{elm.removeClass('selected');self.content.removeClass(c);}});}
this.getFont=function(){var cn=$g.getCookie('articleFontFace');return(cn==null||cn=='undefined')?"simplesans":cn;}
this.getsize=function(){var cn=$g.getCookie('articleTextSize');return(cn==null||cn=='undefined')?"fontsmall":cn;}
this.saveSize=function(e){$g.deleteCookie('articleTextSize');$g.setCookie('articleTextSize',$(e.target).attr("rel"),365);}
this.saveFont=function(e){$g.deleteCookie('articleFontFace');$g.setCookie('articleFontFace',$(e.target).attr("class"),365);}};$(document).ready(function(){var PrettyFonts=new FontStack();PrettyFonts.init();});var ShareBar=function(options){var onSendDone=function(e){var providerEvt='event33';var currProvider={facebook:'event7',twitter:'event32',linkedin:'event18',email:'event6'};for(var n in currProvider){if(e.providers==n){providerEvt=currProvider[n];}}
if(e.providers){var provider=e.providers;s.linkTrackVars=providerEvt;s.events=providerEvt;s.linkTrackEvents=providerEvt;s.tl(this,'o',provider+": Share Published");_gaq.push(['_trackSocial',provider,"Share Published",options.title]);}};var tgamAct=new gigya.socialize.UserAction();tgamAct.setUserMessage(options.userMessage);tgamAct.setTitle(options.title);tgamAct.setLinkBack(options.link);tgamAct.setDescription(options.desc);tgamAct.addActionLink(options.linktext,options.link);if(options.image!=""){tgamAct.addMediaItem({type:'image',src:options.image,href:options.link});}
var parms={containerID:options.container,onSendDone:onSendDone,shareButtons:[{provider:'Share',iconImgUp:'http://cdn.gigya.com/gs/i/sharebar/icons/share3.png'},{provider:'Facebook'},{provider:'Twitter'},{provider:'LinkedIn'},{provider:'Google-plusone'}],iconsOnly:'true',moreEnabledProviders:'gmail, reddit, digg, pinterest, stumbleupon, messenger, evernote, tumblr, delicious, googlebookmarks, myAOL, MySpace, VZnet, Sina, Viadeo, Formspring, Renren, VKontakte, Yardbarker, MisterWong, Orkut, technorati, Xing',userAction:tgamAct};if(typeof currentVideo!=='undefined'&&currentVideo!==0){parms.buttonWithCountTemplate='<div class="videoShareBar"><img class="videoShareBarIcon" src="$iconImg" onclick="$onClick"><div class="videoShareBarCount">$count</div></div>';}
this.init=function(){var c=['tgamShareBar','tgamShareBarBtm'];for(var i=0,l=c.length;i<l;i++){parms.containerID=c[i];gigya.socialize.showShareBarUI(parms);}}};!function(a){var b=function(b){var c=this;b=b||{},"string"==typeof b&&(b={elements:b}),this.sel=null,this.textSelection="",this.htmlSelection="",this.getSelectionText=function(a){var b="",d="",a=a||window.getSelection();if(a.rangeCount){for(var e=document.createElement("div"),f=0,g=a.rangeCount;g>f;++f)e.appendChild(a.getRangeAt(f).cloneContents());d=e.textContent,b=e.innerHTML}return c.textSelection=d,c.htmlSelection=b||d,d},this.selectionDirection=function(a){var b=a||window.getSelection(),c=document.createRange();if(!b.anchorNode)return 0;c.setStart(b.anchorNode,b.anchorOffset),c.setEnd(b.focusNode,b.focusOffset);var d=c.collapsed?"backward":"forward";return c.detach(),d},this.showPopunder=function(){c.popunder=c.popunder||document.getElementById("selectionSharerPopunder");var a=window.getSelection(),b=c.getSelectionText(a);if(a.isCollapsed||b.length<10||!b.match(/ /))return c.hidePopunder();if(c.popunder.classList.contains("fixed"))return c.popunder.style.bottom=0;var d=a.getRangeAt(0),e=d.endContainer.parentNode;if(c.popunder.classList.contains("show")){if(Math.ceil(c.popunder.getBoundingClientRect().top)==Math.ceil(e.getBoundingClientRect().bottom))return;return c.hidePopunder(c.showPopunder)}if(e.nextElementSibling)c.pushSiblings(e);else{c.placeholder||(c.placeholder=document.createElement("div"),c.placeholder.className="selectionSharerPlaceholder");var f=window.getComputedStyle(e).marginBottom;c.placeholder.style.height=f,c.placeholder.style.marginBottom=-2*parseInt(f,10)+"px",e.parentNode.insertBefore(c.placeholder)}var g=window.pageYOffset+e.getBoundingClientRect().bottom;c.popunder.style.top=Math.ceil(g)+"px",setTimeout(function(){c.placeholder&&c.placeholder.classList.add("show"),c.popunder.classList.add("show")},0)},this.pushSiblings=function(a){for(;a=a.nextElementSibling;)a.classList.add("selectionSharer"),a.classList.add("moveDown")},this.hidePopunder=function(a){if(a=a||function(){},"fixed"==c.popunder)return c.popunder.style.bottom="-50px",a();c.popunder.classList.remove("show"),c.placeholder&&c.placeholder.classList.remove("show");for(var b=document.getElementsByClassName("moveDown");el=b[0];)el.classList.remove("moveDown");setTimeout(function(){c.placeholder&&document.body.insertBefore(c.placeholder),a()},600)},this.show=function(a){setTimeout(function(){var b=window.getSelection(),d=c.getSelectionText(b);if(!b.isCollapsed&&d&&d.length>10&&d.match(/ /)){var e=b.getRangeAt(0),f=e.getBoundingClientRect().top-5,g=f+window.scrollY-c.$popover.height(),h=0;if(a)h=a.pageX;else{var i=b.anchorNode.parentNode;h+=i.offsetWidth/2;do h+=i.offsetLeft;while(i=i.offsetParent)}switch(c.selectionDirection(b)){case"forward":h-=c.$popover.width();break;case"backward":h+=c.$popover.width();break;default:return}c.$popover.removeClass("anim").css("top",g+10).css("left",h).show(),setTimeout(function(){c.$popover.addClass("anim").css("top",g)},0)}},10)},this.hide=function(){c.$popover.hide()},this.smart_truncate=function(a,b){if(!a||!a.length)return a;var c=a.length>b,d=c?a.substr(0,b-1):a;return d=c?d.substr(0,d.lastIndexOf(" ")):d,c?d+"...":d},this.getRelatedTwitterAccounts=function(){var b=[],c=a('meta[name="twitter:creator"]').attr("content")||a('meta[name="twitter:creator"]').attr("value");c&&b.push(c);for(var d=document.getElementsByTagName("a"),e=0,f=d.length;f>e;e++)if(d[e].attributes.href&&"string"==typeof d[e].attributes.href.value){var g=d[e].attributes.href.value.match(/^https?:\/\/twitter\.com\/([a-z0-9_]{1,20})/i);g&&g.length>1&&-1==["widgets","intent"].indexOf(g[1])&&b.push(g[1])}return b.length>0?b.join(","):""},this.shareTwitter=function(b){b.preventDefault(),c.viaTwitterAccount||(c.viaTwitterAccount=a('meta[name="twitter:site"]').attr("content")||a('meta[name="twitter:site"]').attr("value")||"",c.viaTwitterAccount=c.viaTwitterAccount.replace(/@/,"")),c.relatedTwitterAccounts||(c.relatedTwitterAccounts=c.getRelatedTwitterAccounts());var d="“"+c.smart_truncate(c.textSelection.trim(),114)+"”",e="http://twitter.com/intent/tweet?text="+encodeURIComponent(d)+"&related="+c.relatedTwitterAccounts+"&url="+encodeURIComponent(window.location.href);c.viaTwitterAccount&&d.length<114-c.viaTwitterAccount.length&&(e+="&via="+c.viaTwitterAccount);var f=640,g=440,h=screen.width/2-f/2,i=screen.height/2-g/2-100;return window.open(e,"share_twitter","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+f+", height="+g+",       top="+i+", left="+h),c.hide(),!1},this.shareEmail=function(){var b=c.htmlSelection.replace(/<p[^>]*>/gi,"\n").replace(/<\/p>|  /gi,"").trim(),d={};return d.subject=encodeURIComponent("Quote from "+document.title),d.body=encodeURIComponent("“"+b+"”")+"%0D%0A%0D%0AFrom: "+document.title+"%0D%0A"+window.location.href,a(this).attr("href","mailto:?subject="+d.subject+"&body="+d.body),c.hide(),!0},this.render=function(){var b='<div class="selectionSharer" id="selectionSharerPopover" style="position:absolute;">  <div id="selectionSharerPopover-inner">    <ul>      <li><a class="action tweet" href="" title="Share this selection on Twitter" target="_blank">Tweet</a></li>      <li><a class="action email" href="" title="Share this selection by email" target="_blank"><svg width="20" height="20"><path stroke="#FFF" stroke-width="6" d="m16,25h82v60H16zl37,37q4,3 8,0l37-37M16,85l30-30m22,0 30,30"/></svg></a></li>    </ul>  </div>  <div class="selectionSharerPopover-clip"><span class="selectionSharerPopover-arrow"></span></div></div>',d='<div id="selectionSharerPopunder" class="selectionSharer">  <div id="selectionSharerPopunder-inner">    <label>Share this selection</label>    <ul>      <li><a class="action tweet" href="" title="Share this selection on Twitter" target="_blank">Tweet</a></li>      <li><a class="action email" href="" title="Share this selection by email" target="_blank"><svg width="20" height="20"><path stroke="#FFF" stroke-width="6" d="m16,25h82v60H16zl37,37q4,3 8,0l37-37M16,85l30-30m22,0 30,30"/></svg></a></li>    </ul>  </div></div>';c.$popover=a(b),c.$popover.find("a.tweet").click(c.shareTwitter),c.$popover.find("a.email").click(c.shareEmail),a("body").append(c.$popover),c.$popunder=a(d),c.$popunder.find("a.tweet").click(c.shareTwitter),c.$popunder.find("a.email").click(c.shareEmail),a("body").append(c.$popunder)},this.setElements=function(b){"string"==typeof b&&(b=a(b)),c.$elements=b instanceof a?b:a(b),c.$elements.mouseup(c.show).mousedown(c.hide).addClass("selectionShareable"),c.$elements.bind("touchstart",function(){c.isMobile=!0}),document.onselectionchange=c.selectionChanged},this.selectionChanged=function(a){c.isMobile&&(c.lastSelectionChanged&&clearTimeout(c.lastSelectionChanged),c.lastSelectionChanged=setTimeout(function(){c.showPopunder(a)},300))},this.render(),b.elements&&this.setElements(b.elements)};a.fn.selectionSharer=function(){var a=new b;return a.setElements(this),this},"function"==typeof define?define(function(){return b.load=function(a,c,d){var e=new b;e.setElements("p"),d()},b}):window.SelectionSharer=b}(jQuery);(function($){$('p').selectionSharer();})(window.jQuery);$g.namespace('globe.common');globe.common.Cache=function(o){var _items={};o=o||{};var _maxSize=o.maxSize||100;var _ttl=o.ttl||2*60*1000;var _policy=o.policy||'FIFO';var _stats={hits:0,misses:0,count:0};var _remove=function(k){delete _items[k];_stats.count--;};var _algorithms={FIFO:function(){for(var k in _items){if(_items.hasOwnProperty(k)){_remove(k);break;}}},LRU:function(){var key;var time=Infinity;for(var k in _items){if(_items[k].used<time){key=k;time=_items[k].used;}}
_remove(key);}};if(!_algorithms[_policy]){throw'Defined policy is not valid: '+_policy;}
var _purge=function(){for(var k in _items){if(_items.hasOwnProperty(k)){var item=_items[k];if(item.expired()){_remove(k);}}}
if(_stats.count>=_maxSize){_algorithms[_policy].call();}};this.get=function(k){var item=_items[k];if(item){if(!item.expired()){var now=new Date().getTime();_stats.hits++;item.used=now;return item.value;}
_remove(k);}
_stats.misses++;return null;};this.set=function(k,v,o){var et;o=o||{};if(o.expireTime){et=o.expireTime;}else if(o.ttl){et=new Date().getTime()+o.ttl;}else{et=new Date().getTime()+_ttl;}
if(_stats.count==_maxSize){_purge();}
if(_items[k]===undefined){_stats.count++;}
_items[k]={value:v,expired:function(){return et<=new Date().getTime();},used:new Date().getTime()};};this.clear=function(){for(var k in _items){if(_items.hasOwnProperty(k)){_remove(_items[k]);}}};this.keys=function(){var arr=[];for(var k in _items){if(_items.hasOwnProperty(k)){arr.push(k);}}
return arr;};this.stat=function(q){return _stats[q];};};(function($){$.fn.csvtable=function(){var $table=this;var $args=arguments[0]||{};var $cache=$args.g_cache;var $reqLink=$args.link;var $reqType=$args.type;var $csvURL=$table.attr('csvurl');var $noPage=$table.attr('nopage');var $pageNum=$table.attr('pageno');var $isComplete=$table.attr('iscomplete');var $tickerCol=$table.attr('tickercol');var $tickerColUrl=$table.attr('tickercolurl');var $sortCol=$table.attr('sortcol');var $sort=$table.attr('sortdir');var $allowSort=$table.attr('allowsort');var $th=$table.find('tr th');var $i=0;var $colNum='';var $colList='';var $colLgth=$th.length;var $overlay=$table.closest('div').hasClass('modal-body');for($i=1;$i<=$colLgth;$i++){$colList=$colList+$i+',';}
$colList=$colList.slice(0,-1);if($pageNum==''){$pageNum=1;}
if($reqType=='page'){$pageNum=$reqLink.attr('page');$colNum=$sortCol;}else{$colNum=$reqLink.attr('rel');if($colNum==$sortCol){if($sort=='asc'){$sort='desc';}else{$sort='asc';}}else{$sort='asc';}}
var $trimURL=$csvURL.replace(/[^a-zA-Z 0-9]+/g,'');var $cachevar="cache_"+$colLgth+"_"+$noPage+"_"+$pageNum+"_"+($overlay?'overlay':'small')+"_"+$colNum+"_"+$sort+"_"+$trimURL;var data=$cache.get($cachevar);if(!data){if($allowSort){var _updatedata="cUrl="+$csvURL+"&cols="+$colList+"&noPage="+$noPage+"&page="+$pageNum+"&isComplete="+$isComplete+"&sort="+$colNum+"&sortDir="+$sort+"&disSort=true&tickerCol="+$tickerCol+"&tickerColUrl="+encodeURIComponent($tickerColUrl);}else{var _updatedata="cUrl="+$csvURL+"&cols="+$colList+"&noPage="+$noPage+"&page="+$pageNum+"&isComplete="+$isComplete+"&sort="+$colNum+"&sortDir="+$sort+"&tickerCol="+$tickerCol+"&tickerColUrl="+encodeURIComponent($tickerColUrl);}
$.ajax({type:"GET",url:$g_conf.publicationUrl+"template/widgets/relatedContents/view/helpers/csvTable.jsp",cache:true,data:_updatedata,dataType:"text",success:function(html){$table.closest('div').html(html);$cache.set($cachevar,html);},error:function(XMLHttpRequest,textStatus,errorThrown){console.log("Error updating CSV data: "+errorThrown);}});}else{$table.closest('div').html(data);}};var opt;$.fn.jqprint=function(options){opt=$.extend({},$.fn.jqprint.defaults,options);var $element=(this instanceof jQuery)?this:$(this);if(opt.operaSupport&&$.browser.opera){var tab=window.open("","jqPrint-preview");tab.document.open();var doc=tab.document;}else{var $iframe=$("<iframe  />");if(!opt.debug){$iframe.css({position:"absolute",width:"0px",height:"0px",left:"-600px",top:"-600px"});}
$iframe.appendTo("body");var doc=$iframe[0].contentWindow.document;}
if(opt.importCSS){if($("link[media=print]").length>0){$("link[media=print]").each(function(){doc.write("<link type='text/css' rel='stylesheet' href='"+$(this).attr("href")+"' media='print' />");});}else{$("link").each(function(){doc.write("<link type='text/css' rel='stylesheet' href='"+$(this).attr("href")+"' />");});}}
if(opt.printContainer){doc.write($element.outer());}
else{$element.each(function(){doc.write($(this).html());});}
doc.close();(opt.operaSupport&&$.browser.opera?tab:$iframe[0].contentWindow).focus();setTimeout(function(){(opt.operaSupport&&$.browser.opera?tab:$iframe[0].contentWindow).print();if(tab){tab.close();}},1000);}
$.fn.jqprint.defaults={debug:false,importCSS:true,printContainer:true,operaSupport:true};jQuery.fn.outer=function(){return $($('<div></div>').html(this.clone())).html();}})(jQuery);$(document).ready(function(){var $g_cache=new globe.common.Cache();$("body").on("click","table.csv-table tr th a",function(e){e.preventDefault();var $table=$(this).closest('table');var $link=$(this);$table.csvtable({g_cache:$g_cache,link:$link,type:'col'});});$(".csv-chart").on("click",".csv-pagination ul li a",function(e){e.preventDefault();var $table=$(this).closest('.csv-pagination').prev('.csv-table');var $link=$(this);$table.csvtable({g_cache:$g_cache,link:$link,type:'page'});});$("body").on("click","a.printit",function(e){e.preventDefault();var $targetId=$(this).attr('target');var $target=$($targetId);$target.jqprint({operaSupport:true});});});