document.querySelectorAll||(document.querySelectorAll=function(t){var e,i=document.createElement("style"),n=[];for(document.documentElement.firstChild.appendChild(i),document._qsa=[],i.styleSheet.cssText=t+"{x-qsa:expression(document._qsa && document._qsa.push(this))}",window.scrollBy(0,0),i.parentNode.removeChild(i);document._qsa.length;)e=document._qsa.shift(),e.style.removeAttribute("x-qsa"),n.push(e);return document._qsa=null,n}),document.querySelector||(document.querySelector=function(t){var e=document.querySelectorAll(t);return e.length?e[0]:null}),function(){function t(){var e={},i=!1,n=null,o=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(i=arguments[0],n++);var s=function(n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(i&&"[object Object]"===Object.prototype.toString.call(n[o])?e[o]=t(!0,e[o],n[o]):e[o]=n[o])};for(n=0;n<o;n++){var r=arguments[n];s(r)}return e}function e(t){var e=t.getBoundingClientRect(),i=document.body;return{top:e.top+i.scrollTop,left:e.left+i.scrollLeft}}function i(t,e){for(var i=t.className?t.className.split(" "):[],n=0;n<i.length;n++)if(i[n]==e)return;i.push(e),t.className=i.join(" ")}function n(t,e){for(var i=t.className.split(" "),n=0;n<i.length;n++)i[n]==e&&(i.splice(n,1),n--);t.className=i.join(" ")}function o(t){var e=document.cookie.match(new RegExp("(?:^|; )"+t.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return e?decodeURIComponent(e[1]):void 0}function s(t,e,i){var n=null;return e=e||100,function(){function o(){i||t.apply(s,r),n=null}var s=this,r=arguments;null!==n?clearTimeout(n):i&&t.apply(s,r),n=setTimeout(o,e)}}function r(t){return!(0===t.offsetWidth&&0===t.offsetHeight)}function a(t){t=t||600;var e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;if(e<=t)return!0;for(var i=navigator.userAgent,n=[/iPhone/i,/iPod/i,/iPad/i,/Android/i,/IEMobile/i,/(?=.*\bWindows\b)(?=.*\bARM\b)/i,/BlackBerry/i,/BB10/i,/Opera Mini/i,/(CriOS|Chrome)(?=.*\bMobile\b)/i,/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i,/(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)/i],o=0,s=n.length;o<s;++o)if(n[o].test(i))return!0;return!1}function l(){var t,e=document.querySelector('link[rel="canonical"]');return e&&(t=e.getAttribute("href")),window.location.href}function c(){return window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop}function u(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(encodeURIComponent(i)+"="+encodeURIComponent(t[i]));return e.join("&")}function h(t){this.name="Медиатор",this.message=t||"Возникла ошибка"}function d(t){throw new h(t)}h.prototype=Object.create(Error.prototype),h.prototype.constructor=h,window._mediatorUtils=t(window._mediatorUtils||{},{extend:t,offset:e,addClass:i,removeClass:n,getCookie:o,debounce:s,isMobile:a,isVisible:r,getLocation:l,getTopViewport:c,console:d,objectToUrlParams:u})}(),function(){"use strict";function t(){var t=I.getElementById("js-mpf-mediator-init"),e=J.attrs,i={counter:parseInt(t.getAttribute(e.counter)),touchCounter:parseInt(t.getAttribute(e.touchCounter)),sectionByClass:"true"===t.getAttribute(e.useSection),adaptive:"true"===t.getAttribute(e.adaptive),autostart:!("false"===t.getAttribute(e.autostart))};return i.counter&&i.touchCounter&&(i.adaptive=!0),i.touchCounter&&(i.isMobile=!0,i.counter=i.touchCounter),delete i.touchCounter,i}function e(e){e=e||null;var i=e?this._opts:z(!0,J,$._opts||{},t());return z(!0,{},i,e)}function i(t){"object"!=typeof t&&D("Переданные опции указаны неверно");var i={cssSels:{}};"undefined"!=typeof t.target&&(t.target instanceof HTMLElement?i.rootElement=t.target:D("Контейнер указан неверно")),"undefined"!=typeof t.targetSelector&&("string"==typeof t.targetSelector&&t.targetSelector?i.cssSels.scrollCont=t.targetSelector:D("Селектор на контейнер указан неверно")),"undefined"!=typeof t.article&&(t.article&&t.article.length?i.articleElement=t.article:t.article instanceof HTMLElement?i.articleElement=[t.article]:D("Контейнер статьи указан неверно")),"undefined"!=typeof t.articleSelector&&("string"==typeof t.articleSelector&&t.articleSelector?i.cssSels.article=t.articleSelector:D("Селектор на контейнер указан неверно")),"boolean"==typeof t.isMobile?i.isMobile=t.isMobile:"undefined"!=typeof t.isMobile&&D("Флаг типа устройства указан неверно"),"undefined"!=typeof t.url&&("string"==typeof t.url?this._state.pathname=t.url:D("Ссылка на страницу указана неверно")),this._opts=e.call(this,i),b.call(this)}function n(){var t=window.navigator.userLanguage||window.navigator.language;return{_timers:{},_handlers:[],_sizes:{},_marks:[],_nodes:null,referrer:I.referrer,pathname:N.getLocation(),lang:K[t]?t:"en",isInited:!1,isStarted:!1}}function o(t){t=t||this._elems.parent;var e=t.querySelectorAll(this._opts.cssSels.section);return[].reduce.call(e,function(t,e){return e.offsetParent&&t.push(e),t},[])}function s(){var t=this._opts,e=t.cssSels,i=t.rootElement||I.querySelector(e.scrollCont);i||(i=I.querySelector("body"));var n={parent:i,article:t.articleElement||i.querySelectorAll(e.article)};return t.sectionByClass?(n.section=o.call(this,i),n.section.length||D("Не найдена ни одна секция")):(n.article&&(n.article||{}).length||(n.article=i.querySelectorAll("article")),n.article&&(n.article||{}).length||D('Не найдены блоки "article"')),n}function r(t,e){I.addEventListener(t||"visibilitychange",e)}function a(t,e,i){i=i||window;for(var n=this._state,o=n._handlers,s=t.split(" "),a=!window.addEventListener,l=0;l<s.length;l++){var c={el:i,name:"",func:e,ie:a},u=s[l];"visibilitychange"==u?(c.el=I,"hidden"in I?(c.name=u,r(c.name,e)):"mozHidden"in I?(c.name="mozvisibilitychange",r(c.name,e)):"webkitHidden"in I?(c.name="webkitHidden",r(c.name,e)):"webkitvisibilitychange"in I?(c.name="webkitvisibilitychange",r(c.name,e)):"msHidden"in I?(c.name="msHidden",r(c.name,e)):"onfocusin"in I?I.onfocusin=I.onfocusout=e:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=e):a?(u="on"+u,c.name=u,i.attachEvent(u,e)):(c.name=u,i.addEventListener(u,e)),o.push(c)}}function l(){var t=this._state,e=this._elems.parent,i=this._opts.timeouts,n=p.bind(this),o=c.bind(this),s=V(E.bind(this),i.sleep),r=b.bind(this),l=a.bind(this);l("resize",V(o,i.resize)),I.body!==e?l("scroll",V(function(){s(),o(),n(),t.isActivePage=!0},i.scroll),e):l("scroll",V(n,i.scroll)),l("load",o),l("hashchange",r),l("visibilitychange blur focus",function(t){t=t||window.event,s();var e=t.type,i=e in X?X[e]:!I.hidden;y.call(this,i,e)}.bind(this)),l("load resize scroll click touchstart keydown hashchange",V(function(t){t=t||window.event,s(),y.call(this,null,t.type)}.bind(this),300,!0)),s()}function c(){var t=this._state;h.call(this),d.call(this),f.call(this),t.isStarted&&p.call(this)}function u(t){var e=[],i=[],n=0;return t&&t.length?(n=t.length-1,[].forEach.call(t,function(t){e.push(t.getBoundingClientRect()),i.push(L(t))})):(e.push(t.getBoundingClientRect()),i.push(L(t))),{rect:{left:e[0].left,right:e[0].right,top:e[0].top,bottom:e[n].bottom,width:e[0].width||e[0].right-e[0].left,height:i[n].top-i[0].top+(e[n].bottom-e[n].top)},offset:i[0]}}function h(){var t=this._elems,e=this._state,i=e._sizes={};for(var n in t)if(t.hasOwnProperty(n)&&t[n]&&("article"!==n||t[n].length)){var o=t[n];if("section"===n&&(o||[]).length){i[n]=[];for(var s=0;s<o.length;s++)i[n][s]=u(o[s])}else{if("article"===n){var r=(o||{}).length;"number"==typeof r&&r>2&&(o=[o[0],o[r-1]])}i[n]=u(o)}}}function d(){var t,e,i,n,o=this._elems,s=this._opts,r=this._state,a=r._sizes,l=r._marks;if(s.sectionByClass)for(t=o.section.length,e=0;e<=t;e++){var c=e==t?e-1:e,u=a.section[c].offset.top;n={start:u,end:u+a.section[c].rect.height},i=l[e],i||(i={events:{}}),i.pos=e==t?n.end:n.start,i.start=i.pos+s.section.triggerStep,l[e]=i}else{t=s.section.count;var h=a.article.offset.top,d=a.article.rect.height,f=r.sectionHeight=d/t;for(n={start:h,end:a.article.offset.top+d},f<s.section.minHeight&&(t=Math.floor(d/s.section.minHeight),f=d/t),e=0;e<=t;e++)i=l[e],i||(i={events:{}}),i.pos=e==t?n.end:n.start+f*e,i.start=i.pos+s.section.triggerStep,l[e]=i}}function f(){function t(){var t=this._opts,e=this._opts.style,i=I.createElement("div"),n=I.createElement("span");return n.style.cssText=e.label,i.appendChild(n),U(i,t.cssClss.mark),i.style.cssText=e.mark,i}function e(t,e){var i="",n=this._state.lang,o=K[n];return i=t<e?o.start+" "+o.section+" "+t:o.end+" "+o.section+" "+(t-1)}var i,n=this._opts,o=this._state,s=o._marks,r=o._nodes;if(r||(r=[]),n.showRule){var a=[],l=I.createDocumentFragment(),c="",u=Math.max(r.length,s.length);for(i=0;i<u;i++){var h=s[i],d=r[i];h?(d||(d=t.call(this),l.appendChild(d)),d.style.top=h.pos+"px",c=e.call(this,i+1,s.length),d.firstChild.textContent=c,d.firstChild.innerText=c,a[i]=d):d&&I.body.removeChild(d)}I.body.appendChild(l),o._nodes=a}else{if(r.length){for(i=0;i<r.length;i++)I.body.removeChild(r[i]);r=null}o._nodes=r}}function p(){var t=this._state,e=this._elems,i=this._opts,n=!!i.sectionByClass||[].every.call(this._elems.article,W);if(t.isActivePage&&t.isInited&&t.isStarted&&n){var o=t._marks,s=t._sizes,r=N.getTopViewport(),a=window.innerHeight||I.documentElement.clientHeight||I.body.clientHeight;e.parent!=I.body&&(r=e.parent.offsetTop,a=Math.min(a,e.parent.clientHeight));for(var l=r+a*i.triggerArea,c=r+a,u=i.sectionByClass?this._elems.section.length:i.section.count,h=i.sectionByClass?o[u].pos:s.article.offset.top+s.article.rect.height,d={reading:t.readingSection,current:null},f=0;f<o.length;f++){var p=o[f];if(p.pos<c){var g=p.events;g.scroll||(k.call(this,{type:"s"+f}),g.scroll=!0),f<u&&p.start<l&&(d.current=f)}}h<r&&(d.current=null),d.current!=d.reading&&(t.readingSection=d.current,m.call(this))}}function m(){var t=this._state,e=this._opts,i=t._marks,n=this._opts.timeouts.hit,o=t._timers.hit;o&&clearTimeout(o),"number"==typeof t.readingSection&&(t._timers.hit=setTimeout(function o(){var s=t.readingSection,r=!!e.sectionByClass||[].every.call(this._elems.article,W);t.isStarted&&t.isActivePage&&"number"==typeof s&&r&&(i[s].events.read||(k.call(this,{type:"ts"+s}),i[s].events.read=!0),k.call(this,{type:"t"+s})),t._timers.hit=setTimeout(o.bind(this),n)}.bind(this),n))}function g(){var t=this._opts;t.isMobile=t.adaptive?F():t.isMobile}function v(){var t=this._elems,e=this._opts,i=this._state,n=I.documentElement.scrollHeight,s=i._sizes.parent.rect.height,r=e.timeouts.height;(function a(){var l=I.documentElement.scrollHeight,h=u(t.parent).rect.height;l==n&&s==h||(n=l,e.sectionByClass&&(t.section=o.call(this)),c.call(this)),i._timers.height=setTimeout(a.bind(this),r)}).bind(this)()}function b(){var t=this._opts,e=I.location.hash.slice(1);e!==t.hashes.showRule&&e!==t.hashes.debug||(t.showRule=!0,this._state.isStarted&&f.call(this)),e===t.hashes.debug&&(t.debug=!0)}function y(t,e){var i=this._state;"boolean"!=typeof t&&(t=!I.hidden),i.isActivePage=t,this._opts.debug&&(console.log("Медиатор: активность окна "+t+(e?" ("+e+")":"")),I.title=t+(e?" ("+e+")":"")),t&&i.isStarted&&p.call(this)}function _(){var t=this._state,e=t._timers;for(var i in e)e.hasOwnProperty(i)&&clearTimeout(i)}function w(){var t=this._state,e=t._handlers;e.forEach(function(t){var e=t.func,i=t.name,n=t.el;t.ie?n.detachEvent(i,e):n.removeEventListener(i,e)})}function S(t){var e=this._state;e.isInited||D("невозможно изменить статус активности модуля без предворительной инициализации");var i=e.isStarted,n=t;"boolean"==typeof t?i===t&&D("Ошибка установки активности модуля"):n=!i,e.isStarted=n}function C(){return this._state.isStarted}function E(){this._state.isStarted&&(this._state.isActivePage=!1,this._opts.debug&&console.log("Медиатор: пользователь не активен"))}function T(t){var e="";if(3===t.nodeType)e=t.nodeValue;else if(1===t.nodeType&&Q.indexOf(t.nodeName)===-1)for(var i=t.childNodes,n=i.length;n--;)e+=T(i[n]);return e}function A(t){return t=(t||{}).length?t:[t],[].reduce.call(t,function(t,e){return t+=T(e)},"")}function x(){var t=this._elems,e=this._opts,i=e.sectionByClass?t.section:t.article,n=A(i);n=n.replace(/[\.\,\?\!]/g," ");var o=n.split(/\s/).filter(function(t){return t.length>2});this._state.wordsCount=o.length}function k(t){var e=this._opts,i=this._state,n={id:e.counter,type:"sendEvent",action:i.pathname,label:[e.isMobile?"mobile":"desktop"].concat("v"==t.type?[i.wordsCount]:[]).join(","),category:t.type,value:2};window._tmr&&window._tmr.push(n),B.call(this,t),e.debug&&console.log("TopMail: "+(O.stringify?O.stringify(n):n)),"function"==typeof e.onPushEvent&&e.onPushEvent(n)}function B(t){var e=this._opts,i=this._state,n={cid:e.counter,url:i.pathname,ref:i.referrer,p:e.isMobile?2:1,e:t.type};"v"===t.type&&(n.wc=i.wordsCount),M(n),e.debug&&console.log("Native: "+(O.stringify?O.stringify(n):n))}function M(t){var e=Y(t);(new Image).src="//collector.mediator.media/register/?"+e}function P(){this._opts=e.call(this),this._state=n.call(this),b.call(this),g.call(this),isNaN(this._opts.counter)&&D("Идентификатор счётчика указан неверно"),this._state.isInited=!0,window._tmr&&window._tmr.push({id:G._opts.counter,type:"pageView",start:(new Date).getTime()})}function j(){this._elems=s.call(this),l.call(this),c.call(this),y.call(this),v.call(this),x.call(this),k.call(this,{type:"v"}),S.call(this,!0)}function q(){var t=this._state;t.isStarted||(w.call(this),_.call(this))}function H(t){t=t||null;var e=this._state;if(e.isInited)try{e.isStarted&&D("Модуль уже запущен. Сначала необхдимо остановить его работу"),P.call(this),t&&(i.call(this,t),g.call(this)),j.call(this),y.call(this)}catch(t){console.error(t.name+": "+t.message)}}var R="_mediator",I=window.document,N=window._mediatorUtils;if(N){var O=window.JSON||{},z=N.extend,L=N.offset,U=N.addClass,V=N.debounce,F=N.isMobile,W=N.isVisible,D=N.console,Y=N.objectToUrlParams,$={};window[R]&&($=window[R]);var G={},J={cssSels:{scrollCont:".js-mediator-container",article:".js-mediator-article",section:".js-mediator-section"},cssClss:{mark:"js-mediator-mark"},attrs:{autostart:"data-autostart",useSection:"data-use-section",counter:"data-counter",touchCounter:"data-mobile-counter",adaptive:"data-adaptive"},hashes:{showRule:"mediator",debug:"mediator-debug"},timeouts:{sleep:3e4,hit:5e3,height:2e3,scroll:300,resize:500},section:{minHeight:0,count:3,triggerStep:0},style:{mark:"position: absolute; left: 0px; right: 0px; height: 4px; z-index: 99; background: #F44E4E;",label:"position: relative; top: -28px; left: 16px; font-family: Arial; font-size: 15px; color: white; background: #F44E4E; line-height: 32px; padding: 0 16px; display: inline-block; border-radius: 3px;"},rootElement:!1,articleElement:!1,counter:null,showRule:!1,isMobile:!1,sectionByClass:!1,triggerArea:.33,debug:!1,onPushEvent:null},K={ru:{start:"Начало",end:"Конец",section:"секции"},en:{start:"Begin",end:"End",section:"section"}},X={focus:!0,focusin:!0,pageshow:!0,blur:!1,focusout:!1,pagehide:!1},Q=["TEXTAREA","SCRIPT","STYLE"],Z=function(){try{P.call(G),G._opts.autostart?j.call(G):q.call(G)}catch(t){console.error(t.name+": "+t.message)}var t=S.bind(G),e=function(){this._opts.showRule=!1,f.call(this)}.bind(G);return{start:function(t){H.call(G,t)},stop:function(){t(!1),e(),q.call(G)},pause:function(){t(!1)},continue:function(){t(!0)},redraw:function(){G._opts.sectionByClass&&(G._elems.section=o.call(G)),c.call(G)},isActive:function(){return C.call(G)}}};(function t(){return"_tmr"in window?void(window[R]=Z()):void setTimeout(t.bind(this),300)}).call(this)}}();
//# sourceMappingURL=mpf-mediator.min.js.map
