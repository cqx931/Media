if(!OF)var OF={};
var InitReaderCommand=function(){this.Extends=SimpleCommand;this.execute=function(a){OF.outside=a.getBody().outside;if("undefined"===typeof OF.outside||null===OF.outside)OF.outside=0;OF.serviceCode=a.getBody().serviceCode;if("undefined"===typeof OF.serviceCode||null===OF.serviceCode)OF.serviceCode=0;OF.ajaxPath=a.getBody().ajaxPath;OF.slicePoint=a.getBody().slicePoint;if("undefined"===typeof OF.ajaxPath||null===OF.ajaxPath)OF.ajaxPath="/";OF.cloudPositionRelative=a.getBody().cloudPositionRelative;if("undefined"===
typeof OF.cloudPositionRelative||null===OF.cloudPositionRelative)OF.cloudPositionRelative=0;OF.topCommentsDynamicList=a.getBody().topCommentsDynamicList;if("undefined"===typeof OF.topCommentsDynamicList||null===OF.topCommentsDynamicList)OF.topCommentsDynamicList=0;if("undefined"!==typeof a.getBody().onetSocialReaderIntegration&&parseInt(a.getBody().onetSocialReaderIntegration,10)){var c=new OF.CommentatorFormProxy(a.getBody());this.facade.registerProxy(c);this.facade.retrieveProxy(c.NAME);this.facade.registerMediator(new OF.CommentatorSaveNoteMediator(new OF.CommentatorSaveNoteComponent))}c=
new OF.ReaderProxy(a.getBody());this.facade.registerProxy(c);this.facade.retrieveProxy(c.NAME);c=a.getBody().cloud;"undefined"!==typeof a.getBody().avatars&&(a.getBody().avatars||(c=0));this.facade.registerMediator(new OF.ReaderMediator(new OF.ReaderComponent));this.facade.registerMediator(new OF.ForumCloudMediator(new OF.ForumCloudComponent,c))}};OF.InitReaderCommand=new Class(new InitReaderCommand);if("undefined"==typeof addthis_config)var addthis_config={services_exclude:"print,favorites",data_track_clickback:!0};
var ReaderProxy=function(){this.Extends=Proxy;this.nextPageUrl=null;this.initialize=function(a){this.ticket=a.ticket;this.parent(OF.ReaderProxy.NAME);this.forumPlatformUrl="http://platforma.forum.onetapi.pl/forum/"};this.addVoteUp=function(a){instance=this;if(null===this.ticket)this.ticket=this.getCookie("onet_ubi");var c=OF.ajaxPath+"addvoteup.json",b={entry_id:a.data.noteData.entry_id,disc_id:a.data.noteData.disc_id,vote:"1",ticket:instance.ticket},d="post",h="json";"undefined"!==typeof OF.outside&&
1===OF.outside&&(h="jsonp",c=instance.forumPlatformUrl+"addvoteup_jp.json",b={entry_id:a.data.noteData.entry_id,disc_id:a.data.noteData.disc_id,vote:"1",ticket:instance.ticket,service_code:OF.serviceCode,"x-onet-app":"notices.front.forum.onetapi.pl","content-type":""},d="get");$.ajax({url:c,dataType:h,data:b,type:d,success:function(b){0==b.error?(instance.localSave(a.data.noteData.entry_id,1),instance.sendNotification(OF.ReaderProxy.OF_VOTE_UP_SUCCESS,a.data)):instance.sendNotification(OF.ReaderProxy.OF_VOTE_UP_FAILED,
a.data)},error:function(){instance.sendNotification(OF.ReaderProxy.OF_VOTE_UP_FAILED,a.data)}})};this.addVoteDown=function(a){instance=this;if(null===this.ticket)this.ticket=this.getCookie("onet_ubi");var c=OF.ajaxPath+"addvotedown.json",b={entry_id:a.data.noteData.entry_id,disc_id:a.data.noteData.disc_id,vote:"-1",ticket:instance.ticket},d="post",h="json";"undefined"!==typeof OF.outside&&1===OF.outside&&(h="jsonp",c=instance.forumPlatformUrl+"addvotedown_jp.json",b={entry_id:a.data.noteData.entry_id,
disc_id:a.data.noteData.disc_id,vote:"-1",ticket:instance.ticket,service_code:OF.serviceCode,"x-onet-app":"notices.front.forum.onetapi.pl","content-type":""},d="get");$.ajax({url:c,dataType:h,data:b,type:d,success:function(b){0==b.error?(instance.localSave(a.data.noteData.entry_id,-1),instance.sendNotification(OF.ReaderProxy.OF_VOTE_DOWN_SUCCESS,a.data)):instance.sendNotification(OF.ReaderProxy.OF_VOTE_DOWN_FAILED,a.data)},error:function(){instance.sendNotification(OF.ReaderProxy.OF_VOTE_DOWN_FAILED,
a.data)}})};this.localSave=function(a,c){var b=$.jStorage.get("votes",{});b[a]=c;$.jStorage.set("votes",b)};this.setNextPageUrl=function(a){instance=this;instance.nextPageUrl=a};this.fetchPage=function(){instance=this;instance.nextPageUrl&&(instance.sendNotification(OF.ReaderProxy.OF_FETCH_PAGE_BEGIN),$.ajax({url:instance.nextPageUrl,dataType:"html",type:"GET",success:function(a){instance.sendNotification(OF.ReaderProxy.OF_FETCH_PAGE_SUCCESS,a)},error:function(a){instance.sendNotification(OF.ReaderProxy.OF_FETCH_PAGE_FAIL,
a)}}))};this.getCookie=function(a){var c,b,d,h=document.cookie.split(";");for(c=0;c<h.length;c++)if(b=h[c].substr(0,h[c].indexOf("=")),d=h[c].substr(h[c].indexOf("=")+1),b=b.replace(/^\s+|\s+$/g,""),b===a)return unescape(d)}};OF.ReaderProxy=new Class(new ReaderProxy);OF.ReaderProxy.NAME="OF_READER_PROXY";OF.ReaderProxy.OF_VOTE_UP_SUCCESS="OF_READER_VOTE_UP_SUCCESS";OF.ReaderProxy.OF_VOTE_UP_FAIL="OF_READER_VOTE_UP_FAILED";OF.ReaderProxy.OF_VOTE_DOWN_SUCCESS="OF_READER_VOTE_DOWN_SUCCESS";
OF.ReaderProxy.OF_VOTE_DOWN_FAIL="OF_READER_VOTE_DOWN_FAILED";OF.ReaderProxy.OF_FETCH_PAGE_BEGIN="OF_FETCH_PAGE_BEGIN";OF.ReaderProxy.OF_FETCH_PAGE_SUCCESS="OF_FETCH_PAGE_SUCCESS";OF.ReaderProxy.OF_FETCH_PAGE_FAIL="OF_FETCH_PAGE_FAIL";
var ReaderComponent=function(){this.Extends=UIComponent;var a=null,c=null;this.nextPageUrl=null;this.initialize=function(){a=this;if(c=$("#k_nForum_Reader_GetMore"))a.nextPageUrl=c.attr("href"),a.xhrInitial=c.val(),a.xhrLoading=$('label[for="k_nForum_Reader_GetMore"].loading').text(),a.xhrError=$('label[for="k_nForum_Reader_GetMore"].error').text(),setTimeout(function(){a.dispatchEvent(new UIEvent(OF.ReaderComponent.OF_FETCH_PAGE_URL,this))},500);$(".k_attachmentImage").click(function(){a.dispatchEvent(new UIEvent(OF.ReaderComponent.OF_SHOW_ATTACHMENT_DETAL,
this))})};this.showAttachFromHash=function(){if((matchedItems=window.location.hash.match(/#att-(\d+)-(\d+)/))&&"object"==typeof matchedItems&&"string"==typeof matchedItems[1]&&"string"==typeof matchedItems[2])noteId=matchedItems[1],attachNumber=matchedItems[2],(element=$("#attachment-"+noteId).parent().find(".k_attachmentImage:last").get(attachNumber))&&a.dispatchEvent(new UIEvent(OF.ReaderComponent.OF_SHOW_ATTACHMENT_DETAL,element))};this.pointOnAttachment=function(b){$(b).parent().find(".k_attachmentDetalPointer").show();
var d=parseInt($(b).css("width")),a=$(b).attr("class").split(" ")[1].substring(2),c=parseInt($(b).css("margin-right"));$(b).parent().find(".k_attachmentDetalPointer .arrow").css("left",a*c+d*a+parseInt(d/2)-7+"px");return a};this.showAttachmentDetail=function(b,d){var a=this;$(d).attr("class");$(d).parent().find(".opened").each(function(){$(this).unbind().click(function(){a.dispatchEvent(new UIEvent(OF.ReaderComponent.OF_SHOW_ATTACHMENT_DETAL,this))});$(this).removeClass("opened")});$(d).addClass("opened").unbind().click(function(){a.closeAttachmentDetail($(this).parent().find(".k_attachmentDetal"));
$(this).unbind().click(function(){a.dispatchEvent(new UIEvent(OF.ReaderComponent.OF_SHOW_ATTACHMENT_DETAL,this))})});var c="",f=$(d).parent().parent().width();b.contWidth=f;c+=a.makeInnerFromType(b);$(d).parent().find(".k_attachmentDetal").html('<div class="close"></div><div class="innerDet"></div>');$(d).parent().find(".k_attachmentDetal .innerDet").html(c);$(d).parent().find(".k_attachmentDetal .innerDet .attDescText")&&300<$(d).parent().find(".k_attachmentDetal .innerDet .attDescText").text().length&&
$(d).parent().find(".k_attachmentDetal .innerDet .attDescText").expander({newLines:4,slicePoint:OF.slicePoint?OF.slicePoint:300,expandText:OF.translate.get("Expand all"),userCollapseText:OF.translate.get("Collapse"),expandPrefix:"... "});$(d).parent().find(".k_attachmentDetal").show(400);$(d).parent().find(".k_attachmentDetal .close").click(function(){a.dispatchEvent(new UIEvent(OF.ReaderComponent.OF_CLOSE_ATTACHMENT_DETAL,this))})};this.makeInnerFromType=function(b){var d="",a=10;switch(parseInt(b.type)){case 3:var a=
/(width=\"[0-9]*\")/g,c=/(height=\"[0-9]*\")/g,f=b.data.embeded.match(a)[0].match(/([0-9]+)/g),g=b.data.embeded.match(c)[0].match(/([0-9]+)/g),i=590,i=600<b.contWidth?590:540<b.contWidth?540:490<b.contWidth?490:410,f=parseInt(i/f*g);b.data.embeded=b.data.embeded.replace(c,'height="'+f+'"');b.data.embeded=b.data.embeded.replace(a,'width="'+i+'"');d+=b.data.embeded;break;case 2:a=600<b.contWidth?10:560<b.contWidth?18:510<b.contWidth?9:34;d+='<img src="'+b.lead_img.replace(",%s,",","+a+",")+'" border="0" />';
break;case 1:c=b.data.url,a=0<c.search("onet.pl")?"":'rel="nofollow"',d=d+'<div class="lPreview">'+("<a "+a+' href="'+c+'" target="_blank"><img src="'+b.lead_img+'" width="150" height="110" border="0" /></a>'),d=d+"</div>"+('<div class="lTitle"><a '+a+' href="'+c+'" target="_blank">'+b.data.title+"</a></div>"),d+='<span class="attDescText">'+b.data.desc+"</span>",d+='<div class="lTitle"><a '+a+' href="'+c+'" target="_blank">'+c+"</a></div>"}return d};this.closeAttachmentDetail=function(b){var d=this;
$(b).parent().find(".opened").removeClass("opened");$(b).parent().find(".k_attachmentImage").unbind().click(function(){d.dispatchEvent(new UIEvent(OF.ReaderComponent.OF_SHOW_ATTACHMENT_DETAL,this))});$(b).html("<div></div>");$(b).hide(400);$(b).parent().find(".k_attachmentDetalPointer").hide(400)};this.attachExpander=function(){var b=this;$(".k_commentHolder .k_content").each(function(){if(!0!==this.expanderAttached){this.expanderAttached=!0;var d=$(this),a=d.parents(".k_commentHolder:parent"),a=
$(a).attr("id"),c="undefined"!==typeof window.notesAttachmentData&&"undefined"!==typeof window.notesAttachmentData[a]?window.notesAttachmentData[a]:{};$(this).expander({newLines:4,slicePoint:OF.slicePoint?OF.slicePoint:300,expandText:OF.translate.get("Expand all"),userCollapseText:OF.translate.get("Collapse"),expandPrefix:"... ",afterExpand:function(){b.replaceIntexts(d,c);b.showIntexts(d)},onCollapse:function(){b.hideIntexts(d)}});$(this).find("span[class^=inset]").get(0)&&b.expanderCollapse(d,c)}})};
this.expanderExpand=function(b,d){var a=this;a.replaceIntexts(b,d);a.showIntexts(b);$(b).find(".read-more").remove();var c=$("<span>").attr({"class":"re-collapse"}).text(""),f=$("<a>").attr({href:""}).text(OF.translate.get("Collapse")).bind("click",function(c){c.preventDefault();a.expanderCollapse(b,d)});c.append(f);$(b).append(c)};this.expanderCollapse=function(b,a){var c=this;c.hideIntexts(b);$(b).find(".re-collapse").remove();var e=$("<span>").attr({"class":"read-more"}).text(" ... "),f=$("<a>").attr({href:""}).text(OF.translate.get("Expand all")).bind("click",
function(e){e.preventDefault();c.expanderExpand(b,a)});e.append(f);$(b).append(e)};this.hideIntexts=function(b){b.find(".k_attachmentDetal").slideUp(500)};this.showIntexts=function(b){b.find(".k_attachmentDetal").slideDown(500)};this.replaceIntexts=function(b,d){a=this;for(var c=0;c<d.length;c++){var e="",f=$(b).parent().width();d[c].contWidth=f;e+='<div class="k_attachmentDetal att'+c+'">'+a.makeInnerFromType(d[c])+"</div>";$(b).find(".inset_"+(c+1)).replaceWith(e);$(b).show(400);$(b).find(".mPreview, .mTitle").click(function(){var b=
parseInt($(this).parent().attr("class").split(" ")[1].substr(3)),a=/(width=\"[0-9]*\")/g,c=/(height=\"[0-9]*\")/g,e=d[b].data.embeded.match(a)[0].match(/([0-9]+)/g),h=d[b].data.embeded.match(c)[0].match(/([0-9]+)/g),k=590,k=600<f?590:540<f?540:490<f?490:410,e=parseInt(k/e*h);d[b].data.embeded=d[b].data.embeded.replace(c,'height="'+e+'"');d[b].data.embeded=d[b].data.embeded.replace(a,'width="'+k+'"');$(this).parent().html(d[b].data.embeded)})}};this.attachShowHideChildren=function(){a=this;$(".k_nForum_ShowHide a").bind("click",
function(b){a.showHideChildren();b.preventDefault()})};this.addVoteUp=function(b){$(b.container).find(".k_nForum_Vote").addClass("voteLoader");a.dispatchEvent(new UIEvent(OF.ReaderComponent.OF_ADD_VOTE_UP,b))};this.addVoteDown=function(b){$(b.container).find(".k_nForum_Vote").addClass("voteLoader");a.dispatchEvent(new UIEvent(OF.ReaderComponent.OF_ADD_VOTE_DOWN,b))};this.attachMarkTips=function(){$(".k_nForum_Mark").each(function(){var b=$(this);if(b.hasClass("k_nForum_noCloud"))return $(b).click(function(b){b.preventDefault()}),
!1;var a=b.parents(".k_nForum_readerTools:parent"),c=500,e="slide";OF.Tools.isSmartDevice()&&(c=1,e="toggle");b.tooltip({onShow:function(){if(OF.Tools.isSmartDevice()){var b=this.getTrigger().position().top;this.getTip().css({top:b-this.getTip().height()-15})}},position:"top left",offset:[-5,200],relative:OF.cloudPositionRelative?!0:!1,events:{def:"click, mouseleave",tooltip:"mouseenter, mouseleave"},delay:c,effect:e});OF.Tools.isSmartDevice()||b.dynamic({bottom:{direction:"down"}});a.find(".k_nForum_MarkTipHolder .k_tooltipClose").click(function(){b.tooltip().hide()});
$("body").click(function(){$(b).tooltip().hide()});$(b).prev().click(function(b){b.stopPropagation()});$(b).click(function(b){b.stopPropagation()})})};this.attachVoteTips=function(){var b=this;$(".k_nForum_Vote").each(function(){var a=$(this),c=a.parents(".k_nForum_readerTools:parent"),e="undefined"!==typeof window.notesData&&"undefined"!==typeof window.notesData[this.id]?window.notesData[this.id]:{},f=$.jStorage.get("votes",{});"undefined"!==typeof e.entry_id&&"undefined"!==typeof f[e.entry_id]&&
(1==f[e.entry_id]?b.voteUpSuccess(c):b.voteDownSuccess(c));if(!0!==this.voteTipsAttached)this.voteTipsAttached=!0,a.bind("click",function(a){var d=$(a.target);d.hasClass("k_nForum_VoteTipUp")?b.addVoteUp({noteData:e,container:c}):d.hasClass("k_nForum_VoteTipDown")&&b.addVoteDown({noteData:e,container:c});a.preventDefault()})})};this.attachShareTips=function(){$(".k_nForum_MoreActionsShare").each(function(){if(!0!==this.shareTipsAttached){this.shareTipsAttached=!0;var b=$(this),a=b.parents(".k_nForum_readerTools:parent"),
c=a.find(".k_nForum_ShareTipHolder .k_nForum_ShareTipLink").val();a.find(".k_nForum_ShareTipHolder .k_nForum_ShareTipLink").attr({"data-url":c});b.bind("click",function(b){var c=a.find(".k_nForum_ShareTipHolder .k_nForum_ShareTipLink").attr("data-url");a.find(".k_nForum_ShareTipHolder .k_nForum_ShareTipLink").val("http://"+window.location.host+c);a.find(".k_nForum_ShareTipHolder .k_tooltipClose").click(function(){a.find(".k_nForum_ShareTipHolder").slideUp(500)});a.find(".k_nForum_ShareTipHolder").slideDown(500);
b.preventDefault()})}})};this.attachMoreToolsTips=function(){var b=this;$(".k_nForum_MoreActionsDown").each(function(){if(!0!==this.moreToolsTipsAttached){this.moreToolsTipsAttached=!0;var a=$(this),c=a.parents(".k_nForum_readerTools:parent"),e=500,f="slide";OF.Tools.isSmartDevice()&&(e=1,f="toggle");a.tooltip({onShow:function(){this.getTrigger().attr({"class":"k_nForum_MoreActionsUp"});if(OF.Tools.isSmartDevice()){var c=this.getTrigger().position().top;this.getTip().css({top:c+18})}b.attachAddThisPlugin(function(){var b=
a.parent().find(".k_nForum_AddThisContainer"),c="http://"+window.location.host+$(b).find(".hid_data").html(),e=$(b).attr("id");0==$(b).find(".addthis_toolbox").length&&(b.append('<div id="addThisTB_'+e+'" class="addthis_toolbox addthis_default_style " ><div class="addThisElement"><a id="'+e+'_fb" class="addthis_button_facebook">&nbsp;Facebook</a></div><div class="addThisElement"><a id="'+e+'_wykop" class="addthis_button_wykop">&nbsp;Wykop</a></div><div class="addThisElement"><a id="'+e+'_twiter" class="addthis_button_twitter">&nbsp;Twitter</a></div><div class="addThisElement"><a id="'+
e+'_compact" class="addthis_button_compact">Wi\u0119cej</a></div></div>'),addthis.toolbox("#addThisTB_"+e,{},{url:c}))})},onHide:function(){this.getTrigger().attr({"class":"k_nForum_MoreActionsDown"})},position:"top left",offset:[220,25],relative:OF.cloudPositionRelative?!0:!1,events:{def:"click, mouseleave",tooltip:"mouseenter, mouseleave"},delay:e,effect:f});$("body").click(function(){$(a).tooltip().hide()});$(a).parent().find(".k_nForum_MoreActionsShare").click(function(){$(a).tooltip().hide()});
$(a).prev().click(function(b){b.stopPropagation()});$(c).click(function(b){b.stopPropagation()})}})};this.voteUpSuccess=function(b){$(b).find(".k_nForum_Vote").replaceWith($("<span>").attr({"class":"k_nForum_MoreAction k_nForum_VoteUp"}).html('<span class="k_nForum_VoteTipDesc">'+OF.translate.get("Your vote")+"</span>"));$(b).find(".k_nForum_Vote").removeClass("voteLoader")};this.voteUpFail=function(){};this.voteDownSuccess=function(b){$(b).find(".k_nForum_Vote").replaceWith($("<span>").attr({"class":"k_nForum_MoreAction k_nForum_VoteDown"}).html('<span class="k_nForum_VoteTipDesc">'+
OF.translate.get("Your vote")+"</span>"));$(b).find(".k_nForum_Vote").removeClass("voteLoader")};this.voteDownFail=function(){};this.showHideChildren=function(){"block"==$(".k_nForum_Child").css("display")?($(".k_nForum_ShowHide a").text(OF.translate.get("Show answers")),$(".k_nForum_Child").slideUp(500)):($(".k_nForum_ShowHide a").text(OF.translate.get("Hide replies")),$(".k_nForum_Child").slideDown(500))};this.attachAddThisPlugin=function(b){"undefined"===typeof addthis&&0===OF.outside&&document.getElementById("addthis-root")?
0===$("#contentShare .addthis_toolbox").length&&function(){var a=document.createElement("script");a.type="text/javascript";a.src="http://s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4def27dd536d6a44&domready=1";a.async=!0;a.addEventListener("load",function(){b()},!1);document.getElementById("addthis-root").appendChild(a)}():0===OF.outside&&b()};this.attachPageFetching=function(){c&&c.click(a.castFetchPageReuest)};this.castFetchPageReuest=function(b){a.dispatchEvent(new UIEvent(OF.ReaderComponent.OF_FETCH_PAGE_REQUEST));
b.preventDefault()};this.showFetchedBegin=function(){c.val(a.xhrLoading);c.addClass("k_inactive").attr("disabled",!0)};this.showFetchedPage=function(b){$(b).appendTo(".k_nForum_ReaderItems");$(".k_nForum_ReaderItem .galv").each(function(){OF.Tools.renderGalvatar(this,36)});this.attachVoteTips();this.attachExpander();this.attachMoreToolsTips();this.attachMarkTips();this.attachShareTips();c.val(a.xhrInitial);c.removeClass("k_inactive").attr("disabled",!1)};this.showFetchFailure=function(){c.val(a.xhrError);
c.removeClass("k_inactive").attr("disabled",!1)};this.hideFetchPageButton=function(){c.hide()};this.addReaderMenu=function(b,a){b&&($("li",".k_nForumReaderMenu ul").length&&$('<li class="spacer">|</li>').appendTo(".k_nForumReaderMenu ul"),a?$('<li><a href="'+a+'">'+b+"</a></li>").appendTo(".k_nForumReaderMenu ul"):$("<li>"+b+"</li>").appendTo(".k_nForumReaderMenu ul"))};this.makeFBCommentBox=function(b,c){var h=OF.translate.get("Add comment"),e='<div id="k_nForumReaderCommentFB" style="position:relative;"><div id="k_nForumReaderCommentFBAvatar"><a target="_blank" href="'+
b.link+'"><img alt="'+b.name+'" src="http://graph.facebook.com/'+b.id+'/picture?type=square" /></a></div><div  id="k_nForumReaderCommentFBRest"><textarea autocomplete="off" name="nf_fb_text" title="'+h+'">'+h+'</textarea><div class="post"><div><span class="addAsName">Dodajesz jako <span class="commentasName">'+b.name+'</span> <a id="fbBoxChangeUser" href="#"> ('+OF.translate.get("Change")+') </a></span><label for="fbBoxSendMsg" id="nForum_commentatorFBBoxButton" ><input type="submit" id="fbBoxSendMsg" value="'+
OF.translate.get("Add comment")+'"></label></div></div><div class="postToProfile"><input type="checkbox" checked="1" name="nf_fb_save" id="fbBoxWallPost"/><label for="fbBoxWallPost" >'+OF.translate.get("Post to Facebook")+'</label></div></div><div id="k_nForumReaderCommentFBGlass"></div><div id="k_nForumReaderCommentFBPreloader"></div></div>';$("#k_nForumReaderCommentFBContainer").html(e);e=$("#k_nForumReaderCommentFBContainer").width()-$("#k_nForumReaderCommentFBAvatar").width()-20;$("#k_nForumReaderCommentFBRest").width(e);
$("#fbBoxChangeUser").click(function(){$(".k_nForum_ReaderShortHeader .k_makeComment").click();return!1});$("#k_nForumReaderCommentFBRest textarea").focus(function(){$(this).val()==h&&$(this).val("")});$("#k_nForumReaderCommentFBRest textarea").blur(function(){""==$(this).val().replace(/^\s+|\s+$/g,"")&&$(this).val(h)});$("#fbBoxSendMsg").click(function(){var a=$("#k_nForumReaderCommentFBRest textarea"),e=$("#fbBoxWallPost");if(""==a.val().replace(/^\s+|\s+$/g,"")||a.val()==h)return a.focus(),!1;
e.attr("checked")?c?f(a,1,b):FB.login(function(c){"undefined"!=typeof c.status&&"connected"===c.status&&f(a,1,b)},{scope:"share_item"}):f(a,0,b)});var f=function(b,c,d){b={text:b.val(),post_fb:c,profile:d};a.dispatchEvent(new UIEvent(OF.ReaderComponent.OF_FB_COMMENTBOX_SEND,b))}}};OF.ReaderComponent=new Class(new ReaderComponent);OF.ReaderComponent.OF_ADD_VOTE_UP="OF_READER_ADD_VOTE_UP";OF.ReaderComponent.OF_ADD_VOTE_DOWN="OF_READER_ADD_VOTE_DOWN";OF.ReaderComponent.OF_SHOW_ATTACHMENT_DETAL="OF_SHOW_ATTACHMENT_DETAL";
OF.ReaderComponent.OF_CLOSE_ATTACHMENT_DETAL="OF_CLOSE_ATTACHMENT_DETAL";OF.ReaderComponent.OF_FETCH_PAGE_REQUEST="OF_FETCH_PAGE_REQUEST";OF.ReaderComponent.OF_FETCH_PAGE_URL="OF_FETCH_PAGE_URL";OF.ReaderComponent.OF_FB_COMMENTBOX_SEND="OF_FB_COMMENTBOX_SEND";
var ReaderMediator=function(){this.Extends=Mediator;this.ReaderProxy=this.component=null;var a;this.initialize=function(c){a=this;this.parent(OF.ReaderMediator.NAME,c);this.component=this.getViewComponent();this.component.attachExpander();this.component.attachMarkTips();this.component.attachVoteTips();this.component.attachMoreToolsTips();this.component.attachShareTips();this.component.attachPageFetching();this.component.addEventListener(OF.ReaderComponent.OF_ADD_VOTE_UP,a.voteUp,this);this.component.addEventListener(OF.ReaderComponent.OF_ADD_VOTE_DOWN,
a.voteDown,this);this.component.addEventListener(OF.ReaderComponent.OF_SHOW_ATTACHMENT_DETAL,a.showAttachmentDetal,this);this.component.addEventListener(OF.ReaderComponent.OF_CLOSE_ATTACHMENT_DETAL,a.closeAttachmentDetal,this);this.component.addEventListener(OF.ReaderComponent.OF_FETCH_PAGE_REQUEST,a.fetchPageRequest,this);this.component.addEventListener(OF.ReaderComponent.OF_FETCH_PAGE_URL,a.setNextPageUrl,this);this.component.addEventListener(OF.ReaderComponent.OF_FB_COMMENTBOX_SEND,a.saveFromFBCommentBox,
this);this.ReaderProxy=this.facade.retrieveProxy(OF.ReaderProxy.NAME);this.CommentatorFormProxy=this.facade.retrieveProxy("OF_COMMENTATOR_FORM_PROXY");$(document).ready(function(){a.sendNotification(OF.ReaderMediator.OF_READER_READY)})};this.showAttachmentDetal=function(a){var b=this.component.pointOnAttachment(a.data),d=$(a.data).parent().parent().find(".k_commentHolder").attr("id");this.component.showAttachmentDetail(("undefined"!==typeof window.notesAttachmentData&&"undefined"!==typeof window.notesAttachmentData[d]?
window.notesAttachmentData[d]:{})[b],a.data)};this.closeAttachmentDetal=function(a){this.component.closeAttachmentDetail($(a.data).parent())};this.voteUp=function(a){this.ReaderProxy.addVoteUp(a)};this.voteDown=function(a){this.ReaderProxy.addVoteDown(a)};this.setNextPageUrl=function(a){a.target.nextPageUrl?this.ReaderProxy.setNextPageUrl(a.target.nextPageUrl):this.component.hideFetchPageButton()};this.fetchPageRequest=function(a){a.target.nextPageUrl?this.ReaderProxy.fetchPage(a.target.nextPageUrl):
this.component.hideFetchPageButton()};this.insertFetchedPage=function(){};this.saveFromFBCommentBox=function(a){this.CommentatorFormProxy.sendFBCommentBox(a)};this.listNotificationInterests=function(){return[OF.ReaderProxy.OF_VOTE_UP_SUCCESS,OF.ReaderProxy.OF_VOTE_UP_FAIL,OF.ReaderProxy.OF_VOTE_DOWN_SUCCESS,OF.ReaderProxy.OF_VOTE_DOWN_FAIL,OF.ReaderProxy.OF_FETCH_PAGE_BEGIN,OF.ReaderProxy.OF_FETCH_PAGE_SUCCESS,OF.ReaderProxy.OF_FETCH_PAGE_FAIL,OF.ReaderMediator.OF_READER_FETCH_PAGE_URL,OF.ReaderMediator.OF_READER_READY,
"ONETSOCIALREADER_USERPROFILE_LOADED"]};this.handleNotification=function(a){var b=this;switch(a.getName()){case OF.ReaderProxy.OF_VOTE_UP_SUCCESS:this.component.voteUpSuccess(a.getBody().container);break;case OF.ReaderProxy.OF_VOTE_UP_FAIL:this.component.voteUpFail(a.getBody().container);break;case OF.ReaderProxy.OF_VOTE_DOWN_SUCCESS:this.component.voteDownSuccess(a.getBody().container);break;case OF.ReaderProxy.OF_VOTE_DOWN_FAIL:this.component.voteDownFail(a.getBody().container);break;case OF.ReaderProxy.OF_FETCH_PAGE_BEGIN:this.component.showFetchedBegin();
break;case OF.ReaderProxy.OF_FETCH_PAGE_SUCCESS:this.component.showFetchedPage(a.getBody());break;case OF.ReaderProxy.OF_FETCH_PAGE_FAIL:this.component.showFetchFailure(a.getBody().container);break;case OF.ReaderMediator.OF_READER_FETCH_PAGE_URL:a.getBody().nextPageUrl?this.ReaderProxy.setNextPageUrl(a.getBody().nextPageUrl):this.component.hideFetchPageButton();break;case OF.ReaderMediator.OF_READER_READY:this.component.showAttachFromHash();break;case "ONETSOCIALREADER_USERPROFILE_LOADED":var d=a.getBody(),
b=this;FB.getLoginStatus(function(a){if(a.authResponse)d.securityToken=a.authResponse.accessToken});FB.api("/me/permissions",function(a){0<a.data.length&&("undefined"!=a.data[0].share_item&&1==a.data[0].share_item?b.component.makeFBCommentBox(d,1):b.component.makeFBCommentBox(d,0))})}}};OF.ReaderMediator=new Class(new ReaderMediator);OF.ReaderMediator.NAME="OF_READER_MEDIATOR";OF.ReaderMediator.OF_READER_READY="OF_READER_READY";OF.ReaderMediator.OF_READER_FETCH_PAGE_URL="OF_READER_FETCH_PAGE_URL";
var ForumCloudComponent=function(){this.Extends=UIComponent;this.parentNickNameCloudLoaded=this.nickNameCloudLoaded=this.avatarCloudLoaded=this.loaded=0;this.initialize=function(){};this.attachCloudToAvatars=function(a){var a=a||{},c=500,b="slide";OF.Tools.isSmartDevice()&&(c=1,b="toggle");this.avatarCloudLoaded||($(".k_avatarHolder:not(.k_locked)").tooltip({onShow:function(){if(OF.Tools.isSmartDevice()){var a=this.getTrigger().position().top;this.getTip().css({top:a-this.getTip().height()-30})}},
events:{def:"click, mouseleave",input:"focus, blur",widget:"focus mouseenter, null",tooltip:"mouseenter, mouseleave"},tipClass:"k_avatarTooltipHolder",position:"top left",offset:a.offset||[-5,183],delay:c,relative:OF.cloudPositionRelative?!0:!1,effect:b,onBeforeShow:function(){$(".nForumTooltip:visible").prev().tooltip().hide()}}),OF.Tools.isSmartDevice()||$(".k_avatarHolder:not(.k_locked)").dynamic({bottom:{direction:"down"}}),$(".k_avatarTooltipHolder").find(".k_tooltipClose").click(function(){$(this).parent().prev().tooltip().hide()}),
OF.Tools.isSmartDevice()&&$("body").click(function(){$.each($(".k_avatarTooltipHolder").prev(),function(){$(this).tooltip().hide()})}),$(".k_avatarTooltipHolder").prev().click(function(a){a.stopPropagation()}),$(".k_avatarTooltipHolder").click(function(a){a.stopPropagation()}));this.avatarCloudLoaded=1};this.attachCloudToNickname=function(a){var a=a||{},c=500,b="slide";OF.Tools.isSmartDevice()&&(c=1,b="toggle");this.nickNameCloudLoaded||($(".k_nForum_Reader .k_author:not(.k_locked)").tooltip({onShow:function(){if(OF.Tools.isSmartDevice()){var a=
this.getTrigger().position().top;this.getTip().css({top:a-this.getTip().height()-30})}},events:{def:"click, mouseleave",input:"focus, blur",widget:"focus mouseenter, null",tooltip:"mouseenter, mouseleave"},tipClass:"k_nickTooltipHolder",position:"top left",offset:a.offset||[-5,183],delay:c,relative:OF.cloudPositionRelative?!0:!1,effect:b,onBeforeShow:function(){$(".nForumTooltip:visible").prev().tooltip().hide()}}),OF.Tools.isSmartDevice()||$(".k_nForum_Reader .k_author:not(.k_locked)").dynamic({bottom:{direction:"down"}}),
$(".k_nickTooltipHolder").find(".k_tooltipClose").click(function(){$(this).parent().prev().tooltip().hide()}),OF.Tools.isSmartDevice()&&$("body").click(function(){$.each($(".k_nickTooltipHolder").prev(),function(){$(this).tooltip().hide()})}),$(".k_nickTooltipHolder").prev().click(function(a){a.stopPropagation()}),$(".k_nickTooltipHolder").click(function(a){a.stopPropagation()}));this.nickNameCloudLoaded=1};this.attachCloudToParentNickname=function(){var a=a||{},c=500,b="slide";OF.Tools.isSmartDevice()&&
(c=1,b="toggle");this.parentNickNameCloudLoaded||($(".k_parentAuthor:not(.k_locked)").tooltip({onShow:function(){if(OF.Tools.isSmartDevice()){var a=this.getTrigger().position().top;this.getTip().css({top:a-this.getTip().height()-30})}},events:{def:"click, mouseleave",input:"focus, blur",widget:"focus mouseenter, null",tooltip:"mouseenter, mouseleave"},tipClass:"k_parentNickTooltipHolder",position:"top left",offset:a.offset||[-5,600],delay:c,relative:OF.cloudPositionRelative?!0:!1,effect:b,onBeforeShow:function(){$(".nForumTooltip:visible").prev().tooltip().hide()}}),
OF.Tools.isSmartDevice()||$(".k_parentAuthor:not(.k_locked)").dynamic({bottom:{direction:"down"}}),$(".k_parentNickTooltipHolder").find(".k_tooltipClose").click(function(){$(this).parent().prev().tooltip().hide()}),OF.Tools.isSmartDevice()&&$("body").click(function(){$.each($(".k_parentNickTooltipHolder").prev(),function(){$(this).tooltip().hide()})}),$(".k_parentNickTooltipHolder").prev().click(function(a){a.stopPropagation()}),$(".k_parentNickTooltipHolder").click(function(a){a.stopPropagation()}),
$(".k_avatarTooltipHolder").find(".k_attachmentImage").unbind("click"))};this.show=function(){this.loaded=1}};OF.ForumCloudComponent=new Class(new ForumCloudComponent);
var ForumCloudMediator=function(){this.Extends=Mediator;this.component=null;this.is_allowed=-1;this.initialize=function(a,c){this.parent(OF.ForumCloudMediator.NAME,a);this.component=this.getViewComponent();if(void 0!=c)this.is_allowed=c};this.listNotificationInterests=function(){return[OF.ReaderMediator.OF_READER_READY,ApplicationFacade.OF_INIT_READER_STARTAPP,ApplicationFacade.OF_INIT_MY_COMMENTS_STARTAPP]};this.handleNotification=function(a){switch(a.getName()){case ApplicationFacade.OF_INIT_READER_STARTAPP:this.is_allowed=
a.getBody().cloud;break;case OF.ReaderMediator.OF_READER_READY:if("true"==this.is_allowed||1==parseInt(this.is_allowed,10))this.component.attachCloudToAvatars(),this.component.attachCloudToNickname(),this.component.attachCloudToParentNickname()}}};OF.ForumCloudMediator=new Class(new ForumCloudMediator);OF.ForumCloudMediator.NAME="OF_FORUM_CLOUD_MEDIATOR";
(function(a){function c(){if(f.jStorage)try{e=n(""+f.jStorage)}catch(a){f.jStorage="{}"}else f.jStorage="{}";i=f.jStorage?(""+f.jStorage).length:0}function b(){try{f.jStorage=m(e),g&&(g.setAttribute("jStorage",f.jStorage),g.save("jStorage")),i=f.jStorage?(""+f.jStorage).length:0}catch(a){}}function d(a){if(!a||"string"!=typeof a&&"number"!=typeof a)throw new TypeError("Key name must be string or numeric");if("__jstorage_meta"==a)throw new TypeError("Reserved key name");return!0}function h(){var a,
c,d,f=Infinity,g=!1;clearTimeout(k);if(e.__jstorage_meta&&"object"==typeof e.__jstorage_meta.TTL){a=+new Date;d=e.__jstorage_meta.TTL;for(c in d)d.hasOwnProperty(c)&&(d[c]<=a?(delete d[c],delete e[c],g=!0):d[c]<f&&(f=d[c]));Infinity!=f&&(k=setTimeout(h,f-a));g&&b()}}if(!a||!a.toJSON&&!Object.toJSON&&!window.JSON)throw Error("jQuery, MooTools or Prototype needs to be loaded before jStorage!");var e={},f={jStorage:"{}"},g=null,i=0,m=a.toJSON||Object.toJSON||window.JSON&&(JSON.encode||JSON.stringify),
n=a.evalJSON||window.JSON&&(JSON.decode||JSON.parse)||function(a){return(""+a).evalJSON()},j=!1,k,l={isXML:function(a){return(a=(a?a.ownerDocument||a:0).documentElement)?"HTML"!==a.nodeName:!1},encode:function(a){if(!this.isXML(a))return!1;try{return(new XMLSerializer).serializeToString(a)}catch(b){try{return a.xml}catch(c){}}return!1},decode:function(a){var b="DOMParser"in window&&(new DOMParser).parseFromString||window.ActiveXObject&&function(a){var b=new ActiveXObject("Microsoft.XMLDOM");b.async=
"false";b.loadXML(a);return b};if(!b)return!1;a=b.call("DOMParser"in window&&new DOMParser||window,a,"text/xml");return this.isXML(a)?a:!1}};a.jStorage={version:"0.1.6.1",set:function(a,c){d(a);if(l.isXML(c))c={_is_xml:!0,xml:l.encode(c)};else{if("function"==typeof c)return;c&&"object"==typeof c&&(c=n(m(c)))}e[a]=c;b();return c},get:function(a,b){d(a);return a in e?e[a]&&"object"==typeof e[a]&&e[a]._is_xml&&e[a]._is_xml?l.decode(e[a].xml):e[a]:"undefined"==typeof b?null:b},deleteKey:function(a){d(a);
return a in e?(delete e[a],e.__jstorage_meta&&"object"==typeof e.__jstorage_meta.TTL&&a in e.__jstorage_meta.TTL&&delete e.__jstorage_meta.TTL[a],b(),!0):!1},setTTL:function(a,c){var f=+new Date;d(a);c=Number(c)||0;if(a in e){if(!e.__jstorage_meta)e.__jstorage_meta={};if(!e.__jstorage_meta.TTL)e.__jstorage_meta.TTL={};0<c?e.__jstorage_meta.TTL[a]=f+c:delete e.__jstorage_meta.TTL[a];b();h();return!0}return!1},flush:function(){e={};b();return!0},storageObj:function(){function a(){}a.prototype=e;return new a},
index:function(){var a=[],b;for(b in e)e.hasOwnProperty(b)&&"__jstorage_meta"!=b&&a.push(b);return a},storageSize:function(){return i},currentBackend:function(){return j},storageAvailable:function(){return!!j},reInit:function(){var a;if(g&&g.addBehavior){a=document.createElement("link");g.parentNode.replaceChild(a,g);g=a;g.style.behavior="url(#default#userData)";document.getElementsByTagName("head")[0].appendChild(g);g.load("jStorage");a="{}";try{a=g.getAttribute("jStorage")}catch(b){}f.jStorage=
a;j="userDataBehavior"}c()}};(function(){var a=!1;if("localStorage"in window)try{window.localStorage.setItem("_tmptest","tmpval"),a=!0,window.localStorage.removeItem("_tmptest")}catch(b){}if(a)try{if(window.localStorage)f=window.localStorage,j="localStorage"}catch(d){}else if("globalStorage"in window)try{window.globalStorage&&(f=window.globalStorage[window.location.hostname],j="globalStorage")}catch(e){}else if(g=document.createElement("link"),g.addBehavior){g.style.behavior="url(#default#userData)";
document.getElementsByTagName("head")[0].appendChild(g);g.load("jStorage");a="{}";try{a=g.getAttribute("jStorage")}catch(i){}f.jStorage=a;j="userDataBehavior"}else{g=null;return}c();h()})()})(window.jQuery||window.$);
