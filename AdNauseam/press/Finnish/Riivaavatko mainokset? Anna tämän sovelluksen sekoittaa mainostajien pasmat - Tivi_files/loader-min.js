var leikiComLoader=leikiComLoader||{};var _leikiw=_leikiw||[];leikiComLoader.Configurations=leikiComLoader.Configurations||(function(){return{widgetsVariableArray:_leikiw,widgetsLoadAnticipation:0.5,showTestPopup:false,adsMaxWait:5000,localStorageKeys:{uid:"leiki_uid"}}})();leikiComLoader.Widget=leikiComLoader.Widget||(function(){return{initWidget:function(l){try{if(l.init)return;l.element=document.getElementById(l.elementId);l.fixedRecommendations=leikiComLoader.Utils.getFixedRecommendations(l);l.init=true}catch(e){}},loadAll:function(){try{for(var i=0;i<leikiComLoader.Configurations.widgetsVariableArray.length;i++){var widget=leikiComLoader.Configurations.widgetsVariableArray[i];leikiComLoader.Widget.initWidget(widget);var isVisible=(widget.loadAlways||widget.isJson||widget.isDfp||widget.isAdtech)?true:leikiComLoader.DomUtils.isVisible(widget);if(isVisible){try{if(widget.isJson){leikiComLoader.Widget.loadJsonWidget(widget)}else if(widget.isDfp){leikiComLoader.Widget.loadDfpWidget(widget)}else if(widget.isAdtech){leikiComLoader.Widget.loadAdtechWidget(widget)}else if(widget.iframe){leikiComLoader.Widget.loadWidgetInIframe(widget)}else{leikiComLoader.Widget.loadWidget(widget)}leiki_first="no"}catch(e){}leikiComLoader.Configurations.widgetsVariableArray.splice(i,1);i--}}if(leikiComLoader.Configurations.showTestPopup){leikiComLoader.Utils.showPopup(leikiComLoader.Configurations.widgetsVariableArray.length+"")}if(leikiComLoader.Configurations.widgetsVariableArray.length>0){if(!window._leikiResizeEvent){window._leikiResizeEvent=true;leikiComLoader.DomUtils.addEvent("scroll",window,leikiComLoader.Widget.loadAll);leikiComLoader.DomUtils.addEvent("resize",window,leikiComLoader.Widget.loadAll)}}else{if(window._leikiResizeEvent){window._leikiResizeEvent=false;leikiComLoader.DomUtils.removeEvent("scroll",window,leikiComLoader.Widget.loadAll);leikiComLoader.DomUtils.removeEvent("resize",window,leikiComLoader.Widget.loadAll)}}}catch(e){}},loadWidget:function(widget){var url=leikiComLoader.Utils.buildWidgetUrl(widget);leikiComLoader.DomUtils.addScriptTag(url,widget.isSynchronous)},loadJsonWidget:function(widget){var url=leikiComLoader.Utils.buildWidgetUrl(widget);var functionName="jsonCallback"+parseInt(Math.random()*1000000000);leikiComLoader[functionName]=function(data){if(typeof(widget.jsonCallback)==="function"){widget.jsonCallback(data)}if(data.leikiUid&&data.leikiUid.trim().length>0){leikiComLoader.Utils.setUserId(data.leikiUid)}};url+="&callback=leikiComLoader."+functionName;leikiComLoader.DomUtils.addScriptTag(url,widget.isSynchronous)},loadDfpWidget:function(widget){var url=leikiComLoader.Utils.buildWidgetUrl(widget);var gotReturn=false;setTimeout(function(){leikiComLoader[functionName]({})},leikiComLoader.Configurations.adsMaxWait);var functionName="jsonCallback"+parseInt(Math.random()*1000000000);leikiComLoader[functionName]=function(data){if(gotReturn){return}gotReturn=true;if(typeof(widget.dfpCallback)==="function"){var params=leikiComLoader.Utils.parseAdParams(data);for(key in params){var values=params[key];if(key&&values&&values.length){googletag.pubads().setTargeting(key,values)}}if(data.leikiUid){googletag.pubads().setTargeting("leikiuid",data.leikiUid)}widget.dfpCallback(data)}if(data.leikiUid&&data.leikiUid.trim().length>0){leikiComLoader.Utils.setUserId(data.leikiUid)}};url+="&callback=leikiComLoader."+functionName;leikiComLoader.DomUtils.addScriptTag(url,widget.isSynchronous)},loadAdtechWidget:function(widget){var url=leikiComLoader.Utils.buildWidgetUrl(widget);var gotReturn=false;setTimeout(function(){leikiComLoader[functionName]({})},leikiComLoader.Configurations.adsMaxWait);var functionName="jsonCallback"+parseInt(Math.random()*1000000000);leikiComLoader[functionName]=function(data){if(gotReturn){leikiComLoader.Widget.loadAdtechAds();return}gotReturn=true;try{var params=leikiComLoader.Utils.parseAdParams(data);var leikiAdtechSegmentStr="";for(key in params){var values=params[key];if(key&&values&&values.length){if(window.ADTECH&&window.ADTECH.config&&window.ADTECH.config.page){if(!window.ADTECH.config.page.kv){window.ADTECH.config.page.kv={}}window.ADTECH.config.page.kv[key]=values}if(widget.isSynchronous){leikiAdtechSegmentStr+="kv"+encodeURIComponent(key)+"=";for(var i=0;i<values.length;i++){if(i>0){leikiAdtechSegmentStr+=":"}leikiAdtechSegmentStr+=encodeURIComponent(values[i])}leikiAdtechSegmentStr+=";"}}}window.leikiAdtechSegmentStr=leikiAdtechSegmentStr;if(data.leikiUid&&data.leikiUid.trim().length>0){leikiComLoader.Utils.setUserId(data.leikiUid)}}catch(e){}leikiComLoader.Widget.loadAdtechAds()};url+="&callback=leikiComLoader."+functionName;leikiComLoader.DomUtils.addScriptTag(url,widget.isSynchronous)},loadAdtechAds:function(){try{ADTECH.enqueueAd=ADTECH._enqueueAd;ADTECH.executeQueue=ADTECH._executeQueue;window._leikicache.forEach(function(item){try{ADTECH[item.name](item.params)}catch(e){}});window._leikicache=[]}catch(e){}},loadWidgetInIframe:function(widget){var el=widget.element;delete widget.init;delete widget.element;var url=widget.server+"/widgets/loader/loader_iframe.html?"+encodeURIComponent(JSON.stringify(widget));leikiComLoader.DomUtils.addIframeTag(el,url,widget.iframe.width,widget.iframe.height)},onClick:function(link,url){try{var gaParamValue="";gaParamValue=leikiComLoader.Utils.getParameterByName(link.href,"_ga");if(!gaParamValue){if(window.ga){var tracker=window.ga.getByName("master");if(!tracker){var trackers=window.ga.getAll();if(trackers&&trackers.length>0){tracker=trackers[0]}}if(tracker){var linker=new window.gaplugins.Linker(tracker);if(linker){var decoratedUrl=linker.decorate(link.href);if(decoratedUrl&&decoratedUrl.length>0){gaParamValue=leikiComLoader.Utils.getParameterByName(decoratedUrl,"_ga")}}}}}if(gaParamValue&&gaParamValue.length>0){url+="&crv="+encodeURIComponent("_ga="+gaParamValue)}link.href=url}catch(e){link.href=url}}}})();leikiComLoader.DomUtils=leikiComLoader.DomUtils||(function(){return{addEvent:function(evnt,elem,func){if(elem.addEventListener){elem.addEventListener(evnt,func,false )}else if(elem.attachEvent){elem.attachEvent("on"+evnt,func)}},removeEvent:function(evnt,elem,func){if(elem.removeEventListener){elem.removeEventListener(evnt,func,false )}else if(elem.detachEvent){elem.detachEvent("on"+evnt,func)}},findPos:function(obj){var curtop=0;if(obj.offsetParent){do{curtop+=obj.offsetTop}while(obj=obj.offsetParent)}return curtop},isVisible:function(l){var windowScroll=(window.pageYOffset!==undefined)?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;var windowHeight=(window.innerHeight)?window.innerHeight:document.documentElement.clientHeight;var elemTop=leikiComLoader.DomUtils.findPos(l.element);var isVisible=((windowHeight*(1+leikiComLoader.Configurations.widgetsLoadAnticipation))+windowScroll-elemTop)>0;return isVisible},addScriptTag:function(url,isSynchronous){if(isSynchronous){document.write("<scr"+"ipt src='"+url+"'></scr"+"ipt>")}else{var s=document.createElement("script");s.type="text/javascript";s.async=true;s.src=url;var x=document.getElementsByTagName("script")[0];x.parentNode.insertBefore(s,x)}},addIframeTag:function(element,url,width,height){var iframe=document.createElement("iframe");iframe.src=url;iframe.style.width=width+((!isNaN(width)||width.indexOf("%")===-1)?"px":"");iframe.style.height=height+((!isNaN(height)||height.indexOf("%")===-1)?"px":"");iframe.style.border="0";iframe.style.backgroundColor="transparent";iframe.style.overflow="hidden";iframe.style.zIndex="100000";iframe.scrolling="no";iframe.frameBorder="no";iframe.allowTransparency=true;element.appendChild(iframe)},addForm:function(url,params){var leiki_iframe_form=document.createElement("form");leiki_iframe_form.target="leikiwidgetcontainerframe";leiki_iframe_form.setAttribute("method","post");leiki_iframe_form.setAttribute("action",url);for(var i=0;i<params.length;i++){var p=params[i];leiki_iframe_form=leikiComLoader.DomUtils.addHiddenInput(leiki_iframe_form,p.name,p.value)}var body=document.body;body.appendChild(leiki_iframe_form);return leiki_iframe_form},addHiddenInput:function(form,name,value){var hiddenField=document.createElement("input");hiddenField.setAttribute("type","hidden");hiddenField.setAttribute("name",name);hiddenField.setAttribute("value",value);form.appendChild(hiddenField);return form},getHtmlData:function(){var html=document.getElementsByTagName("HTML")[0];var htmldata=html.innerHTML;var attributes="";for(var i=0;i<html.attributes.length;i++){attributes+=html.attributes[i].name+"=\""+html.attributes[i].value+"\" "}return "<html "+attributes+">"+htmldata+"</html>"}}})();leikiComLoader.Utils=leikiComLoader.Utils||(function(){return{showPopup:function(text){var l2=document.getElementById("leikiWTestPopup")||document.createElement("div");l2.id="leikiWTestPopup";l2.innerHTML=text;l2.style.position="fixed";l2.style.backgroundColor="red";l2.style.right=0;l2.style.bottom=0;l2.style.padding="5px";var s=document.getElementsByTagName("body")[0];s.parentNode.insertBefore(l2,s)},getFixedRecommendations:function(widget){var arr;if(widget.fixedVariableName){arr=window[widget.fixedVariableName]}if(!arr){arr=window["_leikif_"+widget.name]}return arr},buildWidgetUrl:function(widget){var url=widget.server+"/mwidget?"+leikiComLoader.Utils.buildWidgetParameters(widget);return url},buildWidgetParameters:function(widget){var url="wname="+widget.name+""+((typeof widget.cid!=="undefined"&&widget.cid!="")?"&cid="+encodeURIComponent(widget.cid):"");try{if(typeof leiki_first!=="undefined"){var u=window.location.href;if(this.leiki_first_previous_url&&this.leiki_first_previous_url!=u){delete leiki_first}this.leiki_first_previous_url=u}}catch(e){}if(!widget.forceUserProfiling&&typeof leiki_first!=="undefined"){url+="&first="+leiki_first}else{url+="&first=undefined"}if(widget.referer){url+="&referer="+encodeURIComponent(widget.referer)}if(widget.userTag){url+="&usertag="+encodeURIComponent(widget.userTag)}url+="&ts="+new Date().getTime();if(widget.fixedRecommendations&&widget.fixedRecommendations.length>0){var p="&";for(var i=0;i<widget.fixedRecommendations.length;i++){var f=widget.fixedRecommendations[i];p+="fixed"+(i+1)+"="+encodeURIComponent(f)+"&"}url+=p}var uid=leikiComLoader.Utils.getUserId();if(uid&&uid.trim().length>0){url+="&userid="+uid}return url},parseAdParams:function(widgetResults){var params={};if(widgetResults&&widgetResults.tabs){for(var i=0;i<widgetResults.tabs.length;i++){var tab=widgetResults.tabs[i];if(tab&&tab.items&&tab.headline){var key=tab.headline.toLowerCase();for(var j=0;j<tab.items.length;j++){var item=tab.items[j];var id=item.id;var ids=params[key];if(!ids){ids=[];params[key]=ids}ids.push(id)}}}}return params},getParameterByName:function(url,name){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regex=new RegExp("[\\?&]"+name+"=([^&#]*)"),results=regex.exec(url);return results===null?null:results[1].replace(/\+/g," ")},getUserId:function(){var uid;if(window.localStorage){var uid=window.localStorage.getItem(leikiComLoader.Configurations.localStorageKeys.uid);if(!uid||uid.trim().length==0){uid="-first";leikiComLoader.Utils.setUserId(uid)}}return uid},setUserId:function(uid){if(window.localStorage){window.localStorage.setItem(leikiComLoader.Configurations.localStorageKeys.uid,uid)}}}})();leikiComLoader.AutoScraper=leikiComLoader.AutoScraper||(function(){var _scrape=function(){try{var iframe=document.createElement("iframe");iframe.id="leikiwidgetcontainerframe";iframe.name="leikiwidgetcontainerframe";document.body.appendChild(iframe);iframe.style.display="none";iframe.style.border="0";iframe.style.width="1px";iframe.style.height="1px";iframe.contentWindow.name="leikiwidgetcontainerframe";iframe.onload=function(){try{this.parentNode.removeChild(this)}catch(e){}};var params=[];params.push({name:"leiki_first",value:"no"});params.push({name:"cid",value:leiki_cid});params.push({name:"wname",value:leiki_wname});params.push({name:"ishtml",value:"true"});params.push({name:"htmldata",value:encodeURIComponent(leikiComLoader.DomUtils.getHtmlData())});var form=leikiComLoader.DomUtils.addForm(window.leiki_url,params);iframe.onload=function(){try{this.parentNode.removeChild(this);form.parentNode.removeChild(form)}catch(e){}};form.submit()}catch(e){}};return{scrape:function(count){try{if(!window.leiki_url){return}if(/MSIE (\d+\.\d+);/.test(navigator.userAgent)){return}if(/trident\//.test(navigator.userAgent.toLowerCase())){return}var mobile=(/iphone|ipad|ipod|android|blackberry|mini|windows\sce|palm/i.test(navigator.userAgent.toLowerCase()));if(mobile){return}var i=count||0;window.setTimeout(function(){if(!window.document.readyState||window.document.readyState=="complete"){_scrape()}else if(i<3){window.setTimeout(function(){leikiComLoader.AutoScraper.scrape(i+1)},2000)}},2000)}catch(e){}}}})();leikiComLoader.Widget.loadAll();