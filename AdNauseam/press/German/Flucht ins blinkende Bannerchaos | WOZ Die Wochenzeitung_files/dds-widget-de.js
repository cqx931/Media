if(String.prototype.decode==null){String.prototype.decode=function(){var c=this;var a=this.match(/_[0-9]+_/g);if(a){for(var b=0;b<a.length;b++){regexp=new RegExp(a[b],"g");c=c.replace(regexp,String.fromCharCode(a[b].replace(/_/g,"")))}}return c.toString()}}if(String.prototype.encode==null){String.prototype.encode=function(b){var c="";for(var a=0;a<this.length;a++){if(this.charAt(a).search(/[-A-Za-z0-9]/)==-1){c+="_"+this.charCodeAt(a)+"_"}else{c+=this.charAt(a)}}return c.toString()}}if(String.prototype.endsWith==null){String.prototype.endsWith=function(a){return(this.match(a+"$")==a)}}function EPIK(u,d){if(typeof(console)=="object"&&typeof(console.log)=="function"){this.log=function(w){console.log("EPIK: "+w)}}else{this.log=function(w){}}this.CONSTANTS=new Object();this.CONSTANTS.CONFIG=new Object();this.CONSTANTS.CONFIG.SECURE_COOKIE="secure_cookie";this.CONSTANTS.CONFIG.ENABLE_JQUERY="enable_jquery";this.CONSTANTS.CONFIG.IFRAME_CONTAINER="iframe_container";this.CONSTANTS.CONFIG.AUTO_SUBMIT="auto_submit";this.CONSTANTS.CONFIG.IFRAME_LOADING_PAGE="iframe_loading_page";this.CONSTANTS.CONFIG.TRIGGER_EVENT="trigger_event";this.CONSTANTS.PAYMENT_METHODS=new Object();this.CONSTANTS.PAYMENT_METHODS.SMS="sms";this.CONSTANTS.PAYMENT_METHODS.VISA="visa";this.CONSTANTS.PAYMENT_METHODS.ECA="eca";this.CONSTANTS.PAYMENT_METHODS.AMX="amx";this.CONSTANTS.PAYMENT_METHODS.PEX="pex";this.CONSTANTS.PAYMENT_METHODS.EZS="ezs";this.CONSTANTS.PAYMENT_METHODS.ES="es";this.CONSTANTS.PAYMENT_METHODS.POS="pos";this.CONSTANTS.PAYMENT_METHODS.PFC="pfc";this.CONSTANTS.PAYMENT_METHODS.PEF="pef";this.CONSTANTS.FORM_FIELD=new Object();this.CONSTANTS.FORM_FIELD.AMOUNT="amount";this.CONSTANTS.FORM_FIELD.CURRENCY="currency";this.CONSTANTS.FORM_FIELD.SUCCESS_URL="success_url";this.CONSTANTS.FORM_FIELD.ERROR_URL="error_url";this.CONSTANTS.FORM_FIELD.CANCEL_URL="cancel_url";this.CONSTANTS.FORM_FIELD.TEST_MODE="test_mode";this.CONSTANTS.FORM_FIELD.MOBILE_MODE="mobile_mode";this.CONSTANTS.FORM_FIELD.POLLSTATUS_URL="pollstatus_url";this.CONSTANTS.FORM_FIELD.PAYMENT_METHOD="payment_method";this.CONSTANTS.FORM_FIELD.LANGUAGE="language";this.CONSTANTS.FORM_FIELD.TRANSACTION_ID="transaction_id";this.CONSTANTS.FORM_FIELD.REFNO="refno";this.CONSTANTS.FORM_FIELD.MSISDN="msisdn";this.CONSTANTS.FORM_FIELD.SID="sid";this.CONSTANTS.FORM_FIELD.KEYWORD="keyword";this.CONSTANTS.FORM_FIELD.ES_MESSAGE="es_message";this.CONSTANTS.FORM_FIELD.POPUP="popup";this.CONSTANTS.FORM_FIELD.CARD_HOLDER_NAME="card_holder_name";this.CONSTANTS.FORM_FIELD.RECURRING="recurring";this.CONSTANTS.FORM_FIELD.RECURRING_INTERVAL="recurring_interval";this.CONSTANTS.FORM_FIELD.PAYER_LINE_PREFIX="payer_line";this.CONSTANTS.FORM_FIELD_SELECTOR=":input:not(:button):not(:submit):not(:radio):not(:checkbox):not(.rnw-ignore),:input:checkbox:checked:not(.rnw-ignore),:input:radio:checked:not(.rnw-ignore)";this.CONSTANTS.HTTP_METHOD=new Object();this.CONSTANTS.HTTP_METHOD.POST="POST";this.CONSTANTS.HTTP_METHOD.GET="GET";var i=new Object();i.currency={hidden:false,mandatory:true,sendToEpp:true};i.amount={hidden:false,mandatory:true,sendToEpp:true};i.error_url={hidden:true,mandatory:true,sendToEpp:true};i.cancel_url={hidden:true,mandatory:true,sendToEpp:true};i.success_url={hidden:true,mandatory:true,sendToEpp:true};i.payment_method={hidden:false,mandatory:true,sendToEpp:true};i.test_mode={hidden:true,mandatory:true,sendToEpp:true};i.pollstatus_url={hidden:true,mandatory:false,sendToEpp:false};i.mobile_mode={hidden:true,mandatory:true,sendToEpp:true};i.popup={hidden:true,mandatory:false,sendToEpp:true};i.language={hidden:false,mandatory:true,sendToEpp:true};i.transaction_id={hidden:true,mandatory:false,sendToEpp:true};i.msisdn={hidden:false,mandatory:false,sendToEpp:true};i.sid={hidden:true,mandatory:false,sendToEpp:true};i.keyword={hidden:false,mandatory:false,sendToEpp:true};i.es_message={hidden:false,mandatory:false,sendToEpp:true};i.recurring={hidden:false,mandatory:false,sendToEpp:true};i.recurring_interval={hidden:false,mandatory:false,sendToEpp:true};i.stored_customer_email={hidden:false,mandatory:false,sendToEpp:true};i.secure_cookie={hidden:true,mandatory:false,sendToEpp:false};i.method={hidden:true,mandatory:false,sendToEpp:false};i.addmerchantparameter_url={hidden:true,mandatory:false,sendToEpp:false};i.setfinalstatus_url={hidden:true,mandatory:false,sendToEpp:false};i.apiendpoint={hidden:true,mandatory:false,sendToEpp:false};i.enable_jquery={hidden:true,mandatory:false,sendToEpp:false};i.iframe_container={hidden:true,mandatory:false,sendToEpp:false};i.trigger_event={hidden:true,mandatory:false,sendToEpp:false};i.auto_submit={hidden:true,mandatory:false,sendToEpp:false};i.iframe_loading_page={hidden:true,mandatory:false,sendToEpp:false};this.log("Config parameters initialized");var m={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(z){for(var w=0;w<z.length;w++){var x=z[w].string;var y=z[w].prop;this.versionSearchString=z[w].versionSearch||z[w].identity;if(x){if(x.indexOf(z[w].subString)!=-1){return z[w].identity}}else{if(y){return z[w].identity}}}},searchVersion:function(x){var w=x.indexOf(this.versionSearchString);if(w==-1){return}return parseFloat(x.substring(w+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};m.init();this.log("Check Browser and Browser Version.");if((m.browser=="Firefox"&&m.version<3.4)||(m.browser=="Explorer"&&m.version<8)||(m.browser=="Chrome"&&m.version<6)||(m.browser=="Safari"&&m.version<4)||(m.browser=="Opera"&&m.version<8)){this.log("NotSupportedBrowser")}var j=this;this.options=new Object();var t=function(){};this.beforeSubmit=function(w){t=w;j.options.before_submit=w};this.setSubmitHandler=function(w){j.options.submit_handler=w};if(typeof jQueryFix=="undefined"&&typeof EPIK.jq=="undefined"){throw"NojQueryException"}else{if(typeof EPIK.jq=="undefined"){var r="true";if(typeof u=="string"&&typeof d=="object"){if(d.enable_jquery){r=d.enable_jquery}}else{if(typeof u=="object"&&!d){if(u.enable_jquery){r=u.enable_jquery}}}if(r=="false"){EPIK.jq=jQueryFix.noConflict(true)}else{EPIK.jq=jQueryFix}}}if(parseInt(EPIK.jq().jquery.replace(/[0-9]+\.([0-9]+).[0-9]+/,"$1"))<4){throw"NotSupportedjQueryVersionException : Version greater than 1.4 is needed"}var h=function(){var w=null;if(document.forms.length==1){w=EPIK.jq(document.forms[0])}else{if(document.forms.length>1){throw"MoreThanOneFormFoundException"}else{throw"FormNotFoundException"}}return w};var b=null;this.formKey="";if(!u){b=h()}else{if(typeof u=="string"){b=EPIK.jq("#"+u);this.formKey=u;if(d){this.options=d}}else{if(typeof u=="object"&&!d){b=h();this.options=u}}}if(this.options.iframe_container!=""){var a=EPIK.jq("#"+this.options.iframe_container);if(a.length==0){this.options.iframe_container=""}}if(this.options.before_submit){t=this.options.before_submit}this.updateValueOfField=function(y,A){var w=b.find(":input[name="+y+"]");var x="";if(w.attr("type")){x=w.attr("type").toLowerCase()}var z="click";if(j.options.trigger_event){z=j.options.trigger_event}if(x!="radio"&&x!="checkbox"){w.val(A);w.trigger(z,true)}else{w.each(function(){if(EPIK.jq(this).val()==A){EPIK.jq(this).trigger(z,true);EPIK.jq(this)[0].checked=true}else{EPIK.jq(this)[0].checked=false}})}};this.retrieveValueFromField=function(y){var w=b.find(":input[name="+y+"]");var x="";if(w.attr("type")){x=w.attr("type").toLowerCase()}if(x!="radio"&&x!="checkbox"&&x!="submit"&&x!="button"){return w.val()}else{return EPIK.jq(w.selector+":checked").val()?EPIK.jq(w.selector+":checked").val():""}};this.readCookie=function(z){var A="epik_"+z+"=";var y=document.cookie.split(";");for(var x=0;x<y.length;x++){var w=EPIK.jq.trim(y[x]);if(w.indexOf(A)==0){return w.substring(A.length,w.length)}}return null};this.readValueFromCookie=function(x,B){var A=this.readCookie(B);if(A!=null){var z=A.split("&");for(var y in z){if(z[y].indexOf(x.encode()+":")!=-1){var w=z[y].split(":");if(w.length==2){return w[1].decode()}}}}return null};this.removeFromCookieString=function(w,y){var x=j.readCookie(y);var z=w.encode();if(x!=null){var B=x.indexOf(z+":");if(B!=-1){var A=x.indexOf("&",B);if(A==-1){x=x.substring(0,B-1)}else{x=x.substring(0,B)+x.substring(A+1,x.length)}}}else{x=""}return x};this.removeFromCookie=function(w,x){document.cookie="epik_"+x+"="+this.removeFromCookieString(w,x)+"; ; path=/"};this.deleteCookie=function(x){var w=new Date();w.setTime(w.getTime()-(24*60*60*1000));var y="";if(j.options.secure_cookie&&j.options.secure_cookie=="true"){y="secure;"}document.cookie="epik_"+x+"=null; expires="+w.toGMTString()+"; path=/;"+y};this.updateCookie=function(w,A,z){var y=j.readCookie(z);var C=w.encode();var D=null;if(w!=="cardno"&&w!=="cvv"&&w!=="expy"&&w!=="expm"){if(typeof A=="number"||typeof A=="object"||typeof A=="undefined"){D=A+""}else{if(typeof A=="boolean"){D=A?"1":"0"}else{D=A.encode()}}var x=C+":"+D;if(y==null){y=""}if(y.indexOf(C+":")!=-1&&((y.indexOf(x)==-1&&D!="")||(D==""))){y=j.removeFromCookieString(w,z)}if(y.indexOf(C+":")==-1&&y.indexOf(x)==-1){if(y!=""){y+="&"}y+=x}var B="";if(j.options.secure_cookie&&j.options.secure_cookie=="true"){B="secure;"}document.cookie="epik_"+z+"="+y+"; ; path=/;"+B}};var l=this.readCookie(this.formKey)?this.readCookie(this.formKey).split("&"):new Array();for(var c in l){if(l.hasOwnProperty(c)){var f=l[c].split(":");if(f.length==2){var e=f[0].decode();var k=f[1].decode();if(!this.options[e]){this.options[e]=k}}}}var p=this.readCookie(this.formKey+"_merchantparameter")?this.readCookie(this.formKey+"_merchantparameter").split("&"):new Array();for(var c in p){if(p.hasOwnProperty(c)){var s=p[c].split(":");if(s.length==2){var v=s[0].decode();var o=s[1].decode();if(!this.options[v]){this.options[v]=o}}}}b.find(j.CONSTANTS.FORM_FIELD_SELECTOR).each(function(){var z=EPIK.jq(this);var y=z.attr("name");if(y){var x=j.retrieveValueFromField(y);if(x!=""){var w=j.formKey;if(!i[y]){w=w+"_merchantparameter"}if(y=="amount"){x=parseFloat(x)}if(!j.options[y]||j.options[y]==""){j.options[y]=x;j.updateCookie(y,x,w)}}}});b.find(":input:not(:button):not(:submit)").on("change",function(A,x){var B=EPIK.jq(this);var z=B.attr("name");if(z&&!x){var y=j.retrieveValueFromField(z);var w=j.formKey;if(!i[z]){w=w+"_merchantparameter"}if(z=="amount"){y=parseFloat(y)}j.options[z]=y;j.updateCookie(z,y,w)}});if(!this.options.method){this.options.method="POST";if(b.attr("method")==""){b.attr("method",this.options.method)}}if(!this.options.mobile_mode){this.options.mobile_mode=false}if(!this.options.delete_data_after_submit){this.options.delete_data_after_submit=false}var n=function(){var x=j;var w=i;try{b.find(x.CONSTANTS.FORM_FIELD_SELECTOR).each(function(){var C=EPIK.jq(this);var B=C.attr("name");if(B){var A=j.retrieveValueFromField(B);var z=x.formKey;if(!w[B]){z=z+"_merchantparameter"}if(B=="amount"){A=parseFloat(A)}x.updateCookie(B,A,z)}})}catch(y){}};var q=function(){j.log("auto submit form called");n();var w=true;try{if(b.attr("action")==""){if(j.getApiEndpoint()&&j.getApiEndpoint()!=""){b.attr("action",j.getApiEndpoint())}else{throw"NotDefinedApiEndpointException"}}w=t();if(typeof w!="undefined"&&!w){return false}if(b.attr("action")==j.getApiEndpoint()){j.updateForm(true);j.validateForm();if(!j.options.submit_handler){if(j.options.iframe_container&&j.options.iframe_container!=""){j.createAndSubmitIFrame();w=false}else{w=true}if(typeof j.options.delete_data_after_submit!="undefined"&&j.options.delete_data_after_submit&&j.options.delete_data_after_submit!="false"){j.deleteData()}if(!w){return w}}else{j.log("submit handler called");j.options.submit_handler();return false}}else{if(typeof j.options.submit_handler=="function"){j.options.submit_handler();return false}}}catch(x){j.log(x);return false}return true};this.makeReadyToSubmit=function(){j.log("make ready to submit called");n();var w=true;try{if(b.attr("action")==""){b.attr("action",j.getApiEndpoint())}w=t();if(typeof w!="undefined"&&!w){return false}if(b.attr("action")==j.getApiEndpoint()){j.updateForm(true);j.validateForm();if(typeof j.options.submit_handler=="function"){j.options.submit_handler()}}else{if(typeof j.options.submit_handler=="function"){j.options.submit_handler()}}}catch(x){return false}return true};if(typeof this.options.auto_submit=="undefined"||this.options.auto_submit=="true"){b.submit(function(){return q()})}else{b.submit(function(){return false})}this.updateForm=function(w){j.log("update form called");this.createMandatoryAndNotHiddenFormFields(w);this.createHiddenFormFields();this.createMerchantParameterFields()};this.createMandatoryAndNotHiddenFormFields=function(B){if(!B){B=false}var A;var z;for(var y in i){if(!i[y].hidden&&i[y].mandatory){A=b.find(":input[name="+y+"]");if(A.length==0){var x=j.options[y];if(y=="amount"&&x){x=parseFloat(x)}var w="hidden";if(!B){z=EPIK.jq("<label/>").text(y);b.append(z);w="text"}j.createFormField(y,w,x)}}}};this.createHiddenFormFields=function(){for(var w in i){if(i[w].hidden&&i[w].sendToEpp){j.createFormField(w,"hidden",j.options[w])}}};this.createFormField=function(x,w,z){var y;var A;y=b.find(":input[name="+x+"]");if(typeof z!="function"){if(y.length==0){A=EPIK.jq("<input/>").attr({type:w,value:(z?z:""),name:x});b.append(A)}else{if(y.val()==""){y.val(z?z:"")}}}};this.createMerchantParameterFields=function(){var x;for(var w in j.options){x=b.find(":input[name="+w+"]");if(!i[w]&&x.length==0&&j.options[w]){j.createFormField(w,"hidden",j.options[w])}}};this.validateForm=function(){j.log("validate form called");var y;for(var x in i){if(i[x].mandatory){y=b.find(":input[name="+x+"]");if(y.length==0){throw"MandatoryFieldNotFoundException: Form field "+x+" is missing."}else{var w="";if(y.attr("type")){w=y.attr("type")}if(w!="radio"&&w!="checkbox"){if(!EPIK.jq.trim(y.val())){throw"MandatoryFieldNotFoundException: Form field "+x+" is missing."}}else{if(EPIK.jq(y.selector+":checked").length<1){throw"MandatoryFieldNotFoundException: Form field "+x+" is missing."}}}}}if(j.getRecurring()=="true"){if(!j.options.stored_customer_email){throw ("Parameter stored_customer_email not defined")}if(!j.options.recurring_interval){throw ("Parameter recurring_interval not defined")}}};this.deleteData=function(){j.deleteCookie(j.formKey);j.deleteCookie(j.formKey+"_merchantparameter")};this.fillOutForm=function(z){j.log("fill out form called");if(!z){z=false}var y;for(var x in j.options){y=b.find(":input[name="+x+"]");if(y.length!=0){var w=y.attr("type");if(!w){w=""}if(z||(y.val()==""||(y.is("select")||w=="radio"||w=="checkbox"))){if(x=="amount"){j.updateValueOfField(x,parseFloat(j.options[x]))}else{j.updateValueOfField(x,j.options[x])}}}}};this.addStoredMerchantParameterField=function(y){if(!y.name){throw"StoredMerchantFieldNameIsMissingException"}if(!y.label){y.label=y.name}if(!y.value){y.value=""}if(!y.parent_container){y.parent_container=b}var w="text";if(!y.hidden){y.hidden=false;w="hidden"}if(!y.classes){y.classes=""}var x="";if(!y.hidden){x="<label>"+y.label+"</label>"}y.parent_container.append(x+'<input name="stored_'+y.name+'" type="'+w+'" class="'+y.classes+'" value="'+y.value+'"/>');j.setStoredMerchantParameter(y.name,y.value)};this.addMerchantParameterField=function(y){if(!y.name){throw"MerchantFieldNameIsMissingException"}if(!y.label){y.label=y.name}if(!y.value){y.value=""}if(!y.parent_container){y.parent_container=b}var w="text";if(!y.hidden){y.hidden=false;w="hidden"}if(!y.classes){y.classes=""}var x="";if(!y.hidden){x="<label>"+y.label+"</label>"}y.parent_container.append(x+'<input name="'+y.name+'" type="'+w+'" class="'+y.classes+'" value="'+y.value+'"/>');j.setMerchantParameter(y.name,y.value)};this.setCurrency=function(w){w=w.toLowerCase();j.options.currency=w;j.updateCookie(j.CONSTANTS.FORM_FIELD.CURRENCY,w,j.formKey);j.updateValueOfField(j.CONSTANTS.FORM_FIELD.CURRENCY,w)};this.setAmount=function(x){var w=0;w=parseFloat(x);j.options.amount=w;j.updateCookie(j.CONSTANTS.FORM_FIELD.AMOUNT,w,j.formKey);j.updateValueOfField(j.CONSTANTS.FORM_FIELD.AMOUNT,w)};this.setErrorUrl=function(w){j.options.error_url=w;j.updateCookie(j.CONSTANTS.FORM_FIELD.ERROR_URL,w,j.formKey);j.updateValueOfField(j.CONSTANTS.FORM_FIELD.ERROR_URL,w)};this.setCancelUrl=function(w){j.options.cancel_url=w;j.updateCookie(j.CONSTANTS.FORM_FIELD.CANCEL_URL,w,j.formKey);j.updateValueOfField(j.CONSTANTS.FORM_FIELD.CANCEL_URL,w)};this.setSuccessUrl=function(w){j.options.success_url=w;j.updateCookie(j.CONSTANTS.FORM_FIELD.SUCCESS_URL,w,j.formKey);j.updateValueOfField(j.CONSTANTS.FORM_FIELD.SUCCESS_URL,w)};this.setApiEndpoint=function(w){j.options.apiendpoint=w;j.updateCookie("apiendpoint",w,j.formKey);b.attr("action",w)};this.setMethod=function(w){j.options.method=w;j.updateCookie("method",w,j.formKey);b.attr("method",w)};this.setPollStatusUrl=function(w){j.options.pollstatus_url=w;j.updateCookie(j.CONSTANTS.FORM_FIELD.POLLSTATUS_URL,w,j.formKey);j.updateValueOfField(j.CONSTANTS.FORM_FIELD.POLLSTATUS_URL,w)};this.setPaymentMethod=function(w){w=w.toLowerCase();j.options.payment_method=w;j.updateCookie(j.CONSTANTS.FORM_FIELD.PAYMENT_METHOD,w,j.formKey);j.updateValueOfField(j.CONSTANTS.FORM_FIELD.PAYMENT_METHOD,w)};this.setTestMode=function(w){w=w.toLowerCase();j.options.test_mode=w;j.updateCookie(j.CONSTANTS.FORM_FIELD.TEST_MODE,w,j.formKey);j.updateValueOfField(j.CONSTANTS.FORM_FIELD.TEST_MODE,w)};this.setMobileMode=function(w){w=w.toLowerCase();j.options.mobile_mode=w;j.updateCookie(j.CONSTANTS.FORM_FIELD.MOBILE_MODE,w,j.formKey);j.updateValueOfField(j.CONSTANTS.FORM_FIELD.MOBILE_MODE,w)};this.setLanguage=function(w){w=w.toLowerCase();j.options.language=w;j.updateCookie(j.CONSTANTS.FORM_FIELD.LANGUAGE,w,j.formKey);j.updateValueOfField(j.CONSTANTS.FORM_FIELD.LANGUAGE,w)};this.setStoredMerchantParameter=function(w,x){if(w.indexOf("stored_")!=0){throw"ParameterNameException : Parameter has to start with stored_"}j.options[w]=x;j.updateCookie(w,x,j.formKey+"_merchantparameter");j.updateValueOfField(w,x)};this.setMerchantParameter=function(w,x){if(w.indexOf("stored_")==0){throw"ParameterNameException : Parameter may not start with stored_"}j.options[w]=x;j.updateCookie(w,x,j.formKey+"_merchantparameter");j.updateValueOfField(w,x)};this.setTransactionId=function(w){j.options.transaction_id=w;j.updateCookie(j.CONSTANTS.FORM_FIELD.TRANSACTION_ID,w,j.formKey);j.updateValueOfField(j.CONSTANTS.FORM_FIELD.TRANSACTION_ID,w)};this.setRefNo=function(w){j.options.refno=w;j.updateCookie(j.CONSTANTS.FORM_FIELD.REFNO,w,j.formKey);j.updateValueOfField(j.CONSTANTS.FORM_FIELD.REFNO,w)};this.setESMessage=function(w){j.options.es_message=w;j.updateCookie(j.CONSTANTS.FORM_FIELD.ES_MESSAGE,w,j.formKey);j.updateValueOfField(j.CONSTANTS.FORM_FIELD.ES_MESSAGE,w)};this.setMSISDN=function(w){j.options.msisdn=w;j.updateCookie(j.CONSTANTS.FORM_FIELD.MSISDN,w,j.formKey);j.updateValueOfField(j.CONSTANTS.FORM_FIELD.MSISDN,w)};this.setSID=function(w){j.options.sid=w;j.updateCookie(j.CONSTANTS.FORM_FIELD.SID,w,j.formKey);j.updateValueOfField(j.CONSTANTS.FORM_FIELD.SID,w)};this.setKeyword=function(w){j.options.keyword=w;j.updateCookie(j.CONSTANTS.FORM_FIELD.KEYWORD,w,j.formKey);j.updateValueOfField(j.CONSTANTS.FORM_FIELD.KEYWORD,w)};this.setPayerLine=function(w,y){var x=j.CONSTANTS.FORM_FIELD.PAYER_LINE_PREFIX+w;this.createFormField(x,"hidden",y);j.options[x]=y;j.updateCookie(x,y,j.formKey);j.updateValueOfField(x,y)};this.setPopUp=function(w){j.options.popup=w;j.updateCookie(j.CONSTANTS.FORM_FIELD.POPUP,w,j.formKey);j.updateValueOfField(j.CONSTANTS.FORM_FIELD.POPUP,w)};this.setCardHolderName=function(w){j.options.card_holder_name=w;j.updateCookie(j.CONSTANTS.FORM_FIELD.CARD_HOLDER_NAME,w,j.formKey);j.updateValueOfField(j.CONSTANTS.FORM_FIELD.CARD_HOLDER_NAME,w)};this.setRecurring=function(w){j.options.recurring=w;j.updateCookie(j.CONSTANTS.FORM_FIELD.RECURRING,w,j.formKey);j.updateValueOfField(j.CONSTANTS.FORM_FIELD.RECURRING,w)};this.setRecurringInterval=function(w){j.options.recurring_interval=w;j.updateCookie(j.CONSTANTS.FORM_FIELD.RECURRING_INTERVAL,w,j.formKey);j.updateValueOfField(j.CONSTANTS.FORM_FIELD.RECURRING_INTERVAL,w)};this.setSecureCookie=function(w){j.options.secure_cookie=w;j.updateCookie(this.CONSTANTS.CONFIG.SECURE_COOKIE,w,j.formKey)};this.getCurrency=function(){return j.options.currency};this.getAmount=function(){return j.options.amount};this.getErrorUrl=function(){return j.options.error_url};this.getCancelUrl=function(){return j.options.cancel_url};this.getSuccessUrl=function(){return j.options.success_url};this.getApiEndpoint=function(){return j.options.apiendpoint};this.getMethod=function(){return j.options.method};this.getPollStatusUrl=function(){return j.options.pollstatus_url};this.getPaymentMethod=function(){return j.options.payment_method};this.getTestMode=function(){return j.options.test_mode};this.getMobileMode=function(){return j.options.mobile_mode};this.getLanguage=function(){return j.options.language};this.getMerchantParameter=function(w){if(w.indexOf("stored_")==0){throw"ParameterNameException : Parameter may not start with stored_"}return j.options[w]};this.getStoredMerchantParameter=function(w){if(w.indexOf("stored_")!=0){throw"ParameterNameException : Parameter has to start with stored_"}return j.options[w]};this.getTransactionId=function(){return j.options.transaction_id};this.getRefNo=function(){return j.options.refno};this.getESMessage=function(){return j.options.es_message};this.getPayerLine=function(w){return j.options[j.CONSTANTS.FORM_FIELD.PAYER_LINE_PREFIX+w]};this.getMSISDN=function(){return j.options.msisdn};this.getSID=function(){return j.options.sid};this.getKeyword=function(){return j.options.keyword};this.getPopUp=function(){return j.options.popup};this.getCardHolderName=function(){return j.options.card_holder_name};this.getRecurring=function(){return j.options.recurring};this.getRecurringInterval=function(){return j.options.recurring_interval};this.getSecureCookie=function(){return j.options.secure_cookie};this.createAndSubmitIFrame=function(){var z=j.options.iframe_container;var y=b;if(z){y=EPIK.jq("#"+z);if(y.length==0){throw"NoElementFoundException"}}var A="#";if(j.options.iframe_loading_page){A=j.options.iframe_loading_page}var w=EPIK.jq("<iframe/>").attr({width:"100%",height:"100%",name:"epp_iframe",frameborder:0,src:A});var x=EPIK.jq("<form/>").attr({action:j.getApiEndpoint(),method:j.getMethod()});b.find(j.CONSTANTS.FORM_FIELD_SELECTOR).each(function(){var E=EPIK.jq(this);var D=E.attr("name");if(D){var C=j.retrieveValueFromField(D);if(D=="amount"&&C){C=parseFloat(C)}if(j.options.iframe_landing_url&&j.options.iframe_landing_url!=""){if((D=="success_url"||D=="cancel_url"||D=="error_url")&&C){C=j.options.iframe_landing_url}}var B=EPIK.jq("<input/>").attr({type:"hidden",name:D,value:C});x.append(B)}});y.find("iframe[name=epp_iframe]").remove();y.empty();y.append(w);j.waitUntilLoaded(w,x,A)};this.waitUntilLoaded=function(A,y,z){var w=A;var x=y;if(w[0].readyState){w[0].onreadystatechange=function(){if(this.readyState==="complete"||this.readyState==="loaded"){this.onreadystatechange=null;w.contents().find("body").append(x);w.contents().find("body form").submit()}}}else{w[0].onload=function(){this.onload=null;w.contents().find("body").append(x);w.contents().find("body form").submit()}}};this.redirectToParent=function(){var y=j.getQueryParamValueFromUrl("epayment_status");var w=j.getQueryParamValueFromUrl("error-0");var x=self.location.search;j.addQueryParamsToEpikOptions();if(y=="success"){self.parent.location.href=j.getSuccessUrl()+x;return}else{if(y=="aborted_by_user"){self.parent.location.href=j.getCancelUrl()+x;return}}if(w&&w!=""){self.parent.location.href=j.getErrorUrl()+x;return}};this.waitForConfirmation=function(w){j.stopCounter=false;j.stopPolling=false;j.countTimer=null;j.pollTimer=null;j.countDown(w.start_minutes,w.start_seconds,w.container_id,w.timedout);j.pollStatus(w.merchant_transaction_id,w.epp_transaction_id,w.confirmed,w.declined,w.interval)};this.abortWaitForConfirmation=function(){if(j.countTimer!==null){clearTimeout(j.countTimer)}if(j.pollTimer!==null){clearTimeout(j.pollTimer)}j.stopCounter=true;j.stopPolling=true;j.countTimer=null;j.pollTimer=null};this.countDown=function(y,z,x,w){if(z==0){y=y-1;z=59}else{z=z-1}j.showSMSCounter(y,z,x);if(y>0||z>0){if(!j.stopCounter){j.countTimer=setTimeout(function(){j.countDown(y,z,x,w)},1000)}}else{if(!j.stopCounter){j.stopPolling=true;w()}}};this.showSMSCounter=function(x,y,w){if(x<10){x="0"+x}if(y<10){y="0"+y}EPIK.jq("#"+w).html(x+":"+y)};this.pollStatus=function(A,B,y,x,w){var z="merchant-trx-id="+A;if(B){z="transaction-id="+B}z+="&widget-uuid="+j.options.widget_uuid;EPIK.jq.ajax({url:j.options[j.CONSTANTS.FORM_FIELD.POLLSTATUS_URL],cache:false,crossDomain:true,dataType:"jsonp",contentType:"application/json",data:z,success:function(C){j.parseStatusResponse(EPIK.jq.parseJSON(C),A,B,y,x,w)},error:function(D,C,E){}})};this.parseStatusResponse=function(z,A,B,y,x,w){if(z.status=="pending"){if(!j.stopPolling){j.pollTimer=setTimeout(function(){j.pollStatus(A,B,y,x,w)},w*1000)}}else{if(z.status=="confirmed"){j.stopCounter=true;y()}else{j.stopCounter=true;x()}}};this.addQueryParamsToEpikOptions=function(){var x=j.getQueryParams();for(var w in x){if(j.options[w]){if(j.options[w]!=x[w]){}}else{j.options[w]=x[w];j.updateCookie(w,x[w],j.formKey)}}};this.getQueryParams=function(){var w=self.location.href;if(w.endsWith("#")){w=w.substring(0,w.length-1)}w.match(/\?(.+)$/);var A=RegExp.$1;A=A.split("&");var z={};for(var y=0;y<A.length;y++){var x=A[y].split("=");z[x[0]]=decodeURIComponent(x[1])}return z};this.getQueryParamValueFromUrl=function(w){return j.getQueryParams()[w]};var g=function(z){var y=Array(0,9,4,6,8,2,7,1,3,5);var x=0;for(var w=0;w<z.length;w++){x=y[(x+parseInt(z.substr(w,1)))%10]}return(10-x)%10};this.createCompleteRefNo=function(C,y){if(!C||(C+"").length!=6){throw"BankingCustomerIdentificationException"}if(!y){y=""}if(typeof y!="string"){throw"FormatException: Code must be a string"}var A=(C+"").length+(y+"").length;var x="000000000000000000000000000";if(A>27){throw"OutOfRangeException: Only 20 digits are allowed for the code"}else{if(A==27){var w=(C+"")+(y+"");if(g(w.substr(0,w.length-1))==w.substr(w.length-1)){throw"CheckDigitException"}else{x=w}}else{var B=27-A-1;var z="";if(B>0){z=(Math.pow(10,B)+"").substr(1)}x=(C+"")+z+(y+"");x=x+g(x)}}return x};this.getBaseUri=function(){var w=j.options.apiendpoint;if(w.indexOf("http")==0){w=w.substring(0,w.indexOf("/",8)+1)}else{w=""}return w};this.getMerchantConfigId=function(){var x=j.options.apiendpoint;var w="";var y=x.lastIndexOf("/");if(x.length-1>y){w=x.substr(y+1)}else{x=x.substring(0,y);w=x.substr(x.lastIndexOf("/")+1)}return w};this.sendMerchantParameter=function(D,x,z,C,B){var A=C;var y=B;var w=j.options.addmerchantparameter_url;if(w.length>0){EPIK.jq.ajax({url:w,type:"POST",data:"transaction-id="+D+"&parameter-name="+encodeURIComponent(x)+"&parameter-value="+encodeURIComponent(z),success:function(E){if(typeof A=="function"){A(E)}},error:function(F,E,G){if(typeof A=="function"){y(F,E,G)}}})}};this.sendFinalSuccessStatus=function(B,A,z){var y=A;var x=z;var w=j.options.setfinalstatus_url;if(w.length>0){EPIK.jq.ajax({url:w,type:"POST",data:"transaction-id="+B,success:function(C){if(typeof y=="function"){y(C)}},error:function(D,C,E){if(typeof y=="function"){x(D,C,E)}}})}}}(function(f){var d,a=window.rnwWidget||{},c;a.widgets=a.widgets||{};a.widgets.instances=a.widgets.instances||{};a.modules=a.modules||{};function h(i,j){i=i.toString();while(i.length<j){i="0"+i}return i}Date.prototype.toISO8601DateString=function(){return[this.getFullYear(),h(this.getMonth()+1,2),h(this.getDate(),2)].join("-")};function b(i){var j=i,k;while(j.length>2){k=j.slice(0,9);j=parseInt(k,10)%97+j.slice(k.length)}return parseInt(j,10)%97}c={CH:21,LI:21,DE:22,AT:20,FR:27,IT:27,};Array.prototype.remove=function(l){var j=[],k;for(k=0;k<this.length;k++){if(this[k]!==l){j.push(this[k])}}return j};function e(i,j){this.initialize(i,j)}f.extend(e.prototype,{initialize:function(i,j){this.widget=i;this.fieldName=j;this.isSetting=false},hasField:function(){return this.widget.jGet('[name="'+this.fieldName+'"]').length>0},get:function(){return this.widget.epik.retrieveValueFromField(this.fieldName)},set:function(i){if(!this.isSetting){this.isSetting=true;this.oldValue=this.get();this.beforeUpdate(i);this.internalSet(i);this.afterUpdate(i);this.isSetting=false}},internalSet:function(i){this.widget.epik.updateValueOfField(this.fieldName,i)},beforeUpdate:function(i){},afterUpdate:function(i){},});function g(i,j){var k=function(l,m){this.initialize(l,m)};f.extend(k.prototype,j||e.prototype,i);return k}a.utils=a.utils||{registerWidget:function(j,i){a.widgets[j]=a.widgets[j]||{};a.widgets[j].initializer=i},registerModule:function(i,j){a.modules[i]=j},applyModules:function(k,j){for(var i in a.modules){k.modules[i]=k.modules[i]||{};a.modules[i].initialize(k,j)}},normalizeMSISDN:function(i){i=i.replace(/\s/g,"");if(i.substr(0,3)==="+41"){return i}else{if(i.match(/^0[1-9]/)){i=i.substr(1,i.length)}else{if(i.substr(0,4)==="0041"){i=i.substr(4,i.length)}}}return"+41"+i},getCreditCardType:function(j,k){var i=null;j=j.replace(/[ -]+/g,"");if(j.match(/^(4)/g)){i="vis"}else{if(j.match(/^(5[0-5])/g)){i="eca"}else{if(j.match(/^3[4|7]/g)){i="amx"}else{if(j.match(/^36/g)){i="din"}else{if(j.match(/^35/g)){i="jcb"}}}}}return(k===undefined||k.indexOf(i)>=0?i:null)},normalizeIban:function(i){return i.replace(/\s+/g,"").toUpperCase()},getIbanChecksum:function(j){var k=j.slice(4)+j.slice(0,2)+"00",i=k.replace(/[A-Z]/g,function(l){return l.charCodeAt(0)-55});return 98-b(i)},isValidIban:function(i){var l=a.utils.normalizeIban(i),k=a.utils.getIbanChecksum(l),j=c[l.slice(0,2)];return j!==undefined&&l.length===j&&parseInt(l.slice(2,4))===k},legacyConfiguration:function(i){if(window.ddsWidgetConfig===undefined){return}if(typeof(window.ddsWidgetConfig.ddsWidgetLoaded)==="function"){i.widget.on(a.constants.events.WIDGET_LOADED,window.ddsWidgetConfig.ddsWidgetLoaded)}if(window.ddsWidgetConfig.ddsStoredParameters instanceof Object){i.storedParameters=f.extend({},window.ddsWidgetConfig.ddsStoredParameters,i.storedParameters)}if(window.ddsWidgetConfig.css!==undefined){if(f.isArray(window.ddsWidgetConfig.css)){i.css.concat(window.ddsWidgetConfig.css)}else{i.css.push(window.ddsWidgetConfig.css)}}},getUrlParam:function(j){if(d===undefined){var m=location.search.substr(1).split("&");d={};for(var k=0;k<m.length;k++){var l=m[k].split("=");d[l[0]]=decodeURIComponent(l[1])}}return(j===undefined?d:d[j])},fieldHandlerByName:function(j,i){return{isMatch:function(k,l){if(typeof(l)==="string"){return l===j}else{return j.test(l)}},handler:g(i),}},fieldHandlerBySelector:function(i,j){return{isMatch:function(k,m){var l=k.jGet('[name="'+m+'"],[data-name="'+m+'"]').first();return l.is(i)},handler:g(j),}},defaultFieldHandler:function(i,j){return new e(i,j)},evaluateCondition:function(k){var i,j;if(a.utils.conditionVariables[k.variable]!==undefined){i=a.utils.conditionVariables[k.variable];j=a.utils.conditionOperators[k.operator];return j(i,k.reference)}return false},conditionVariables:{ieversion:(function(){if(/MSIE (\d+\.\d+);/.test(navigator.userAgent)){return new Number(RegExp.$1)}})(),},conditionOperators:{lt:function(j,i){return j<i},lte:function(j,i){return j<=i},gt:function(j,i){return j>i},gte:function(j,i){return j>=i},eq:function(j,i){return j==i},},};a.constants=a.constants||{events:{WIDGET_LOADED:"rnw-widget-loaded",PAGE_LOADED:"rnw-widget-page-loaded",AMOUNT_CHANGED:"rnw-widget-amount-changed",PAYMENT_METHOD_CHANGED:"rnw-widget-payment-method-changed",DONATION_TYPE_CHANGED:"rnw-widget-donation-type-changed",PURPOSE_CHANGED:"rnw-widget-purpose-changed",INTERVAL_CHANGED:"rnw-widget-interval-changed",VALIDATING_PARAMETERS:"rnw-widget-validating-parameters",VALIDATION_ERROR:"rnw-widget-validation-error",PAYMENT_COMPLETE:"rnw-widget-payment-complete",PROCESS_FORM:"rnw-widget-process-form",BEFORE_SUBMIT:"rnw-widget-before-submit",},moduleEvents:{MODAL_OPEN:"rnw-widget-modal-open",MODAL_CLOSE:"rnw-widget-modal-close",ELEMENT_SELECTED:"rnw-widget-tab-selected",ELEMENT_ADDED:"rnw-widget-member-added",ELEMENT_REMOVED:"rnw-widget-member-removed",},steps:{DONATION_TARGET:"donation-target",AMOUNT:"amount",PAYMENT_METHOD:"payment-method",CUSTOMER_IDENTITY:"customer-identity",CUSTOMER_ADDRESS:"customer-address",RECIPIENT_INFORMATION:"recipient-information",MEMBERS:"members",},modes:{FORM:"form",SUBSCRIPTION:"subscription",},paymentStatus:{SUCCESS:"success",ABORTED_BY_USER:"aborted_by_user",TIMEOUT:"timeout",ABORTED:"aborted",ERROR:"error",},};window.rnwWidget=a;if(f.validator!==undefined){f.validator.addMethod("msisdn",function(m,i){var l=a.utils.normalizeMSISDN(m);var k=new RegExp("^\\+417[56789][0-9]{7}$","g");var j=this.optional(i)||k.test(l);if(j&&m!==l){f(i).val(l)}return j},"Please enter a correct Swiss mobile number");f.validator.addMethod("iban",function(j,i){return this.optional(i)||a.utils.isValidIban(j)},"Please enter a valid IBAN number");f.validator.addMethod("ibanCountry",function(j,i,l){var k=a.utils.normalizeIban(j);return l.indexOf(k.slice(0,2))>=0},"The IBAN number belongs to a country that is not supported")}})(jQueryFix);(function(c){if(rnwWidget.widgets.BaseWidget!==undefined){return}function a(d,e){this.widget=d;this._setGlobalDefaults();this.extend(e.widgetParams);this.epikOptions=c.extend(true,{},e.epikOptions);this.epikOptions.iframe_container=d.getId("iframe_wrapper");this.translations=e.translations;this.jsonpTemplateUrl=e.jsonpTemplateUrl;this.widgetBaseUrl=e.widgetBaseUrl;this.widgetDefaultUrl=e.widgetDefaultUrl;this.css=e.css;this.scripts=e.scripts;this.validationOptions=c.extend(true,d._validateOptions(this),this._getValidationTranslations());this._updateWidgetCss()}c.extend(a.prototype,{_setGlobalDefaults:function(){this.common={overlay_target:"body",field_class_prefix:"field-",overlay_heights:{pfc:545,pef:545,vis:400,},};this.defaults={};this.extend(this.widget._defaultOptions())},_getValidationTranslations:function(){if(this.translations.validation===undefined||this.translations.validation.class_rules===undefined){return{}}return{classRules:this.translations.validation.class_rules}},_updateWidgetCss:function(){var d=this;d.css=c.map(d.css,function(e){return d.widgetBaseUrl+e})},_finalize:function(){this.finalized=true;var e=this,g=window.rnwWidget.utils.getUrlParam(),f=/^(?:dds|rnw)-(.*)$/,d;c.each(g,function(h,i){d=h.match(f);if(d!==null){e.defaults[d[1]]=i}})},extend:function(d){c.extend(true,this,d)},getDefault:function(e,d){var f=this.defaults[e];if(d===undefined||d){delete this.defaults[e]}return f},});var b={_initialize:function(d,f,e){this.j=d;this.element=f;this.widgetName=e.widgetName;this.widgetUUID=e.widgetUUID;this.id=this.widgetUUID+"-"+(this.element.data("name")||"default");this.wclBase=[this.widgetName,"-"].join("");this.modules={};this.loaded=false;this._fieldHandlerCache={};this._eventBuffering=true;this._eventBuffer=[];this._computedFields=null;this.options=new a(this,e);this._configureWidget();this._injectCss();this._loadTemplate()},jGet:function(d){return this.j(d,this.element)},wcl:function(e,d){return(d===false?"":".")+this.wclBase+e},getId:function(d){return this.id+"-"+d},on:function(d,e){var f=this;this.element.on(d,function(g){e.call(f,g)});return this},showBlock:function(d){this.toggleBlock(d,true)},hideBlock:function(d){this.toggleBlock(d,false)},toggleBlock:function(e,d){var f=this.jGet('[data-block-id="'+e+'"]');this._toggleElement(f,d)},showStep:function(d){this.toggleStep(d,true)},hideStep:function(d){this.toggleStep(d,false)},toggleStep:function(f,d){var e=this.jGet(this.wcl("step-"+f));if(this._toggleElement(e,d)){this._reindexSteps()}},showPage:function(d){var e=this.currentPage||c();this.currentPage=this.jGet(this.wcl("page-"+d));this._toggleElement(e,false);this._toggleElement(this.currentPage,true);this._trigger(window.rnwWidget.constants.events.PAGE_LOADED,{oldPage:e},this.currentPage)},get:function(d){return this._getFieldHandler(d).get()},set:function(e,d){this._getFieldHandler(e).set(d)},_configureWidget:function(){if(typeof(window.rnwWidget.configureWidget)==="function"){window.rnwWidget.configureWidget(this.options)}else{window.rnwWidget.utils.legacyConfiguration(this.options)}this.options._finalize();this.options.defaults.stored_rnw_widget_uuid=this.widgetUUID;this.options.defaults.stored_rnw_widget_instance_id=this.id;this.options.defaults.stored_rnw_source_url=window.location.href},_getTemplateVariables:function(){return{instanceName:this.id,}},_injectCss:function(){var f=this,e=f.j("head");function d(g){f.j("<link>",{rel:"stylesheet",type:"text/css",href:g}).appendTo(e)}f.j.each(f.options.css,function(g,h){if(typeof(h)==="string"){d(h)}else{if(window.rnwWidget.utils.evaluateCondition(h)){d(h.path)}}})},_loadTemplate:function(){var d=this;c.ajax({url:d.options.jsonpTemplateUrl,type:"GET",cache:false,dataType:"jsonp",jsonpCallback:"getWidgetTemplate",crossDomain:true,success:function(g){var e,f=d._getTemplateVariables(),h=c(g.replace(/@\(([^)]+)\)/g,function(j,i){return f[i]}));h.appendTo(d.element);d.form=d.jGet(d.wcl("full-form"));d._initializeValidation();rnwWidget.utils.applyModules(d,h);d.epik=new EPIK(d.form.attr("id"),d.options.epikOptions);d.epik.deleteData();d._injectCustomFields();d._setupBlockVisibility();d._registerActionHandlers();d.on(window.rnwWidget.constants.events.PROCESS_FORM,d._processFormPayerLines);d._onTemplateLoaded();d._reindexSteps();d._setDefaults();d._releaseEventBuffer();d.loaded=true;d._trigger(window.rnwWidget.constants.events.WIDGET_LOADED);e=d._getInitialPage();if(e!==null){d.showPage(e)}}})},_setupBlockVisibility:function(){var d=this,e=this.options.process;if(e===undefined||e.blocks===undefined){return}d.j.each(e.blocks.show,function(g,f){d.showBlock(f)});d.j.each(e.blocks.hide,function(g,f){d.hideBlock(f)})},_injectCustomFields:function(){var h=this;if(h.options.custom_fields===undefined){return}for(var i in h.options.custom_fields){var f=h.options.custom_fields[i],g=ich[h.getId("ich_field_"+f.type)],d=h.jGet('[data-block-id="'+f.reference+'"]'),e;if(g===undefined){throw'unknown field type "'+f.type+'"'}if(d.length===0){throw'unknown reference block ID "'+f.reference+'"'}e=g(c.extend({},f,{fieldName:i,fieldId:h.getId(i),blockId:"custom-"+i,}));if(typeof(f.location)==="function"){f.location(d,e)}else{if(typeof(f.location)==="string"&&typeof(d[f.location])==="function"){d[f.location](e)}else{throw'location "'+f.location+'" is not a function or the name of a function on the reference object'}}rnwWidget.utils.applyModules(h,e)}},_setDefaults:function(e,d){var h=this,f=/^stored_/,i=/\*$/,g;h.j.each(h.options.defaults,function(j,k){if(e!==undefined){if(i.test(j)){j=j.substring(0,j.length-1)+d.toString()}if(e.find('[name="'+j+'"]').length===0){return}}if(i.test(j)){return}g=h._getFieldHandler(j);if(f.test(j)&&!g.hasField()){h.j("<input/>").attr("type","hidden").attr("name",j).appendTo(h.form)}g.set(k)})},_getInitialPage:function(){var d=window.rnwWidget.utils.getUrlParam("dds-subscription");if(d){this.mode=window.rnwWidget.constants.modes.SUBSCRIPTION;this._loadSubscriptionInformation(d);return null}this.mode=window.rnwWidget.constants.modes.FORM;return"form"},_trigger:function(d,e,h){var g=this,f=g.j.Event(d);c.extend(f,e,{widget:g});if(g._eventBuffering){g._eventBuffer.push({target:h,event:f})}else{(h||g.element).trigger(f)}return f},_releaseEventBuffer:function(){var d=this;d._eventBuffering=false;d.j.each(d._eventBuffer,function(f,e){(e.target||d.element).trigger(e.event)});d._eventBuffer=[]},_toggleElement:function(e,d){var f=e.is(this.wcl("shown"))?true:(e.is(this.wcl("hidden"))?false:undefined);if((d===true&&f===undefined)||((d===true||d===undefined)&&!f)){e.removeClass(this.wcl("hidden",false)).addClass(this.wcl("shown",false));return true}else{if((d===false&&f===undefined)||((d===false||d===undefined)&&f)){e.removeClass(this.wcl("shown",false)).addClass(this.wcl("hidden",false));return true}}return false},_reindexSteps:function(){var d=this;d.jGet(d.wcl("step")+d.wcl("shown")+" "+d.wcl("step-number-text")).each(function(e){d.j(this).text(e+1)})},_loadSubscriptionInformation:function(d){var e=this;this.subscriptionToken=d;c.ajax({url:e.options.widgetDefaultUrl+"subscription.php?widget-uuid="+e.widgetUUID+"&token="+d+"&action=info",cache:false,crossDomain:true,dataType:"jsonp",contentType:"application/json",data:{},success:function(f){var g=c.parseJSON(f),h=ich[e.getId("ich_subscription_info")];e.jGet(e.wcl("subscription-info-container")).empty().append(h(g));e.showPage("edit-subscription")}})},_initializeValidation:function(){var d=this,f={},e;if(d.j.validator===undefined){return}d._validationMessages={};c.each(d.options.validationOptions.classRules,function(h,g){e=c.extend({},g);d._validationMessages[d.options.common.field_class_prefix+h]=e.messages;delete e.messages;f[d.options.common.field_class_prefix+h]=e});d.j.validator.addClassRules(f);d.form.validate(d.options.validationOptions);d._validationInitialized=true},_getFieldHandler:function(e){var d=this;if(!(e in d._fieldHandlerCache)){c.each(d._fieldHandlers,function(g,f){if(f.isMatch(d,e)){d._fieldHandlerCache[e]=new f.handler(d,e);return false}})}if(!(e in d._fieldHandlerCache)){d._fieldHandlerCache[e]=window.rnwWidget.utils.defaultFieldHandler(d,e)}return d._fieldHandlerCache[e]},_processFormPayerLines:function(f){var d=f.widget,g=d.epik.CONSTANTS.FORM_FIELD.PAYER_LINE_PREFIX;if(d.paymentMethod==="ezs"||d.paymentMethod==="es"){f.computedFields[g+"1"]=d.get("stored_customer_firstname")+" "+d.get("stored_customer_lastname");f.computedFields[g+"2"]=d.get("stored_customer_street")+" "+d.get("stored_customer_street_number");f.computedFields[g+"3"]=d.get("stored_customer_zip_code")+" "+d.get("stored_customer_city");f.computedFields[g+"4"]=d.get("stored_customer_country")}},_registerActionHandlers:function(){var d=this;d.jGet("[data-action]").on("click",function(g){var f=d.j(this),h=f.data();g.preventDefault();if(h.action in d._actionHandlers){d._actionHandlers[h.action].call(d,f,h)}else{throw"Unknown action handler '"+h.action+"'"}})},_actionHandlers:{"clear-interval":function(d,e){this.epik.abortWaitForConfirmation()},},_prepareAndSubmitEpik:function(){var e=this,f={},d;e._trigger(window.rnwWidget.constants.events.PROCESS_FORM,{computedFields:f});e._trigger(window.rnwWidget.constants.events.BEFORE_SUBMIT,{computedFields:f});e._computedFields=f;for(d in e._computedFields){e.epik.createFormField(d,"hidden",f[d])}if(e.paymentMethod==="ezs"||e.paymentMethod==="es"){if(e.paymentMethod==="ezs"&&e.epik.options.crmc_url!==baseResponseUrl){e.j.ajax({url:e.epik.options.crmc_url,cache:false,crossDomain:true,dataType:"jsonp",contentType:"application/json",data:{"widget-uuid":e.epik.options.widget_uuid,"campaign-id":e.get("stored_campaign_id")},success:function(g){that.epik.setRefNo(g);that.epik.makeReadyToSubmit();that.epik.createAndSubmitIFrame()},error:function(h,g,i){}});return}else{e.epik.setRefNo(1)}}e.epik.makeReadyToSubmit();e.epik.createAndSubmitIFrame()},_onEpikResponse:function(f){var i=this,d=f.epayment_status,h,j,g;i.epik.deleteData();for(h in i._computedFields){i.jGet('[name="'+h+'"]').remove()}i._onBeforeEpikResponseProcess(f);if(i.mode===window.rnwWidget.constants.modes.FORM){if(d===window.rnwWidget.constants.paymentStatus.SUCCESS){g=i._epikResponseProcess(f);if(g!==false){j=i._trigger(window.rnwWidget.constants.events.PAYMENT_COMPLETE,{paymentStatus:d,payment:f});if(!j.isDefaultPrevented()){i._onEpikSuccess(f)}}}else{if(d===window.rnwWidget.constants.paymentStatus.ABORTED_BY_USER){j=i._trigger(window.rnwWidget.constants.events.PAYMENT_COMPLETE,{paymentStatus:d,payment:f});if(!j.isDefaultPrevented()){i._onEpikCancel(f)}}else{j=i._trigger(window.rnwWidget.constants.events.PAYMENT_COMPLETE,{paymentStatus:d,payment:f});if(!j.isDefaultPrevented()){i._onEpikError(f)}}}}else{if(i.mode===window.rnwWidget.constants.modes.SUBSCRIPTION){}}},_epikResponseProcess:function(d){var f=this._successHandlers[d.payment_method.toLowerCase()]||this._successHandlers.fallback,e=true;if(f!==undefined){e=f.call(this,d,this._successHandlers.fallback||this.j.noop)}return e},_successHandlers:{sms:function(e,f){var g=this;function d(h,i){var j;g.epik.abortWaitForConfirmation();g._hideSmsPoll(e);i.call(g,e,g.j.noop);j=g._trigger(window.rnwWidget.constants.events.PAYMENT_COMPLETE,{paymentStatus:h,payment:e});if(!j.isDefaultPrevented()){g._onEpikSuccess(e)}}g._showSmsPoll(e);g.epik.waitForConfirmation({start_minutes:59,start_seconds:59,container_id:g.getId("timer_countdown"),epp_transaction_id:e.epp_transaction_id,interval:5,confirmed:function(){d(e.epayment_status,f)},timedout:function(){d(window.rnwWidget.constants.paymentStatus.TIMEOUT,g._onEpikCancel)},declined:function(){d(window.rnwWidget.constants.paymentStatus.ABORTED,g._onEpikCancel)},});return false},},_fieldHandlers:[rnwWidget.utils.fieldHandlerBySelector(".single-checkbox",{initialize:function(d,e){this.widget=d;this.fieldName=e;this.checkbox=this.widget.jGet('[name="'+this.fieldName+'"]')},internalSet:function(e){var d=(e===true?this.checkbox.val():(e===false?"":e));if(this.widget.j.type(e)==="string"&&e!==this.checkbox.val()){this.checkbox.val(e)}this.beforeUpdate(e);this.widget.epik.updateValueOfField(this.fieldName,d);this.afterUpdate(e)},}),],_onEpikSuccess:function(d){},_onEpikError:function(d){},_onEpikCancel:function(d){},_onBeforeEpikResponseProcess:function(d){},_showSmsPoll:function(d){},_hideSmsPoll:function(d){},_onTemplateLoaded:function(){},_validateOptions:function(d){},_defaultOptions:function(){},};rnwWidget.widgets.BaseWidget=b}(jQueryFix));(function(e,d){var c=window.rnwWidget.constants,a=[d,"-"].join("");function f(h,g){return(g===false?"":".")+a+h}function b(g,i,h){this._initialize(g,i,h)}e.extend(true,b.prototype,window.rnwWidget.widgets.BaseWidget,{_onTemplateLoaded:function(){this.amountField=this.jGet("input[name=amount]");this.msisdnField=this.jGet("input[name=msisdn]");this._initializeVisuals();this._initializeAmountControls();this._initializeMsisdnControl();this._initializeNotification();this._registerPageChangeHandler();var g=this;this.jGet(f("btn")).on("click",function(h){h.preventDefault();g.processPayment()})},_initializeVisuals:function(){this.showPage("form")},_registerPageChangeHandler:function(){var g=this;this.jGet("[data-show]").on("click",function(h){h.preventDefault();g.showPage(g.j(this).data("show"))})},_initializeAmountControls:function(){var g=this,h=g.jGet(f("custom-amount")),i=h.find("input");g.jGet(f("amounts")+" a").on("click",function(j){j.preventDefault();i.val("...");g._activateAmount(g.j(this))});i.on("focus",function(){g._activateAmount(h);g.j(this).val("")});i.on("blur",function(){if(g.j(this).val()===""){g.j(this).val("...")}});i.keyup(function(){var j=g.j(this);j.val(j.val().replace(/[^0-9]/g,""));if(j.val().indexOf("0")===0||j.val().indexOf(" ")===0){j.val("")}if(j.val().length>2){j.val(j.val().substring(0,2))}g.set("amount_internal",parseInt(j.val(),10)*100)})},_initializeMsisdnControl:function(){var g=this;this.jGet(f("input-mobile")).keyup(function(){var j=g.j(this),l=g.j.trim(j.val()),k=/^0/,h=/^7/,i=/[^0-9+ ]/;j.parent().removeClass("error");if(l.match(k)){l=l.replace(k,"+41");j.val(l)}else{if(l.match(h)){j.val("+41"+l)}else{if(l.match(i)){l=l.replace(i,"");j.val(l)}}}if(j.val().length>20){j.val(j.val().substring(0,20))}}).blur(function(){g.j(this).val(g.j(this).val().replace(/ /g,""))})},_initializeNotification:function(){var g=this.jGet(f("notification"));g.find(f("notification-close")).on("click",function(h){h.preventDefault();g.hide()})},_activateAmount:function(h){var g=this.jGet(f("amounts")+" li a"),i=this.jGet(f("custom-amount"));g.add(i).removeClass("active");h.addClass("active");this.set("amount_internal",h.data("value"))},notify:function(i,g){g=g||false;var h=this.jGet(f("notification"));h.find(f("notification-content")).html(i);h.fadeIn();if(g){window.setTimeout(function(){h.fadeOut()},g)}},processPayment:function(){var j=this,i=j.msisdnField.val(),k={},h=new RegExp("^\\+417[6789][0-9]{7}$","g"),g=j.get("amount")>0;j._trigger(c.events.VALIDATING_PARAMETERS,null,j.form);if(h.test(i)&&g){j.epik.makeReadyToSubmit();if(j.epik.options.use_pay_proxy==="true"){j.jGet(":input").each(function(){var l=j.j(this);if(l.attr("name")){k[l.attr("name")]=l.val()}});j.j.ajax({url:j.options.widgetDefaultUrl+"payproxy.php",cache:false,crossDomain:true,dataType:"jsonp",contentType:"application/json",data:k,success:function(l){j._onEpikResponse(j.j.parseJSON(l))},error:function(m,l,n){j._onEpikResponse({epayment_status:c.paymentStatus.ERROR})},})}else{alert("not implemented yet.")}}else{if(!g){j._trigger(c.events.VALIDATION_ERROR,{error:"invalid amount",errorCode:1},j.amountField);j.notify(j.options.translations.common.invalidAmountMessage)}else{j._trigger(c.events.VALIDATION_ERROR,{error:"invalid msisdn",errorCode:2},j.msisdnField);j.msisdnField.parent().addClass("error")}}},_onEpikSuccess:function(g){this.showPage("thanks")},_onEpikError:function(g){this.showPage("form");this.notify(this.options.translations.result.errorMessage)},_onEpikCancel:function(g){this.showPage("form");if(g.epayment_status===c.paymentStatus.TIMEOUT){this.notify(this.options.translations.result.timedoutMessage)}else{this.notify(this.options.translations.result.declinedMessage)}},_showSmsPoll:function(g){this.showPage("confirm")},_successHandlers:{fallback:function(g){},},_fieldHandlers:window.rnwWidget.widgets.BaseWidget._fieldHandlers.concat([rnwWidget.utils.fieldHandlerByName("amount",{set:function(j){var g=this.widget.jGet(f("amounts")+" li a"),i=this.widget.jGet(f("custom-amount")),h=g.filter('[data-value="'+j+'"]');if(h.length>0){this.widget._activateAmount(h)}else{this.widget._activateAmount(i);i.find("input").val(j/100);this.widget.set("amount_internal",j)}},}),rnwWidget.utils.fieldHandlerByName("amount_internal",{set:function(g){this.beforeUpdate(g);this.widget.amountField.val(g);this.afterUpdate(g)},afterUpdate:function(g){this.widget._trigger(c.events.AMOUNT_CHANGED,{amount:g})},}),]),});window.rnwWidget.utils.registerWidget(d,b)}(jQueryFix,rnwWidget.widgets.currentName));